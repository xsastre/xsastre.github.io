
<!doctype html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://xsastre.github.io/Antics/6.6.Laravel.html">
      
      
      
      
      <link rel="icon" href="../imagenes/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.9">
    
    
      
        <title>FRAMEWORK LARAVEL - Docencia Xavier</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans+Condensed:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"IBM Plex Sans Condensed";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#framework-laravel" class="md-skip">
          Salta el contingut
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Capçalera">
    <a href=".." title="Docencia Xavier" class="md-header__button md-logo" aria-label="Docencia Xavier" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Docencia Xavier
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FRAMEWORK LARAVEL
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Canviar a mode dia"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Canviar a mode dia" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Neteja" aria-label="Neteja" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicialitzant cerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegació" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Docencia Xavier" class="md-nav__button md-logo" aria-label="Docencia Xavier" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Docencia Xavier
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Inici
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Inici
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inici
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DWEC
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            DWEC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Moduls/DWEC/_DWEC2425.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Desenvolupament web en entorn client - DAW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Moduls/DWEC/desenvolupamentfrontend.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Desenvolupamet frontend
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AW
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            AW
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Moduls/AW/00.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Temporització aproximada
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Moduls/AW/01.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aplicacions web
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Moduls/AW/02.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTML
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="framework-laravel">FRAMEWORK LARAVEL<a class="headerlink" href="#framework-laravel" title="Permanent link">&para;</a></h1>
<h2 id="api">API<a class="headerlink" href="#api" title="Permanent link">&para;</a></h2>
<h3 id="creant-el-resource-controller">Creant el Resource controller<a class="headerlink" href="#creant-el-resource-controller" title="Permanent link">&para;</a></h3>
<p>Laravel pot crear un controlador amb mètodes ja establits per a una api, i tindre llest tot per a l'ús dels verbs HTTP. Tot en 1 senzill pas:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php artisan make:controller Api/MovieController -r
</code></pre></div>
<p>El -r, significa que aquest controller s'usarà com a recurs, i laravel deixa els mètodes llestos per a ser omplits. De no agregar -r, es crearà un controller totalment buit, la qual cosa ens donaria més treball, i a ningú li agrada treballar. El creem dins del directori api per separar-lo dels altres.
Vegem com ens va quedar:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>&lt;?php
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>namespace App\Http\Controllers\Api;
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>use Illuminate\Http\Request;
<span class="linenos" data-linenos=" 6 "></span>use App\Http\Controllers\Controller;
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>class MovieController extends Controller
<span class="linenos" data-linenos=" 9 "></span>{
<span class="linenos" data-linenos="10 "></span>    /**
<span class="linenos" data-linenos="11 "></span>     * Display a listing of the resource.
<span class="linenos" data-linenos="12 "></span>     *
<span class="linenos" data-linenos="13 "></span>     * @return \Illuminate\Http\Response
<span class="linenos" data-linenos="14 "></span>     */
<span class="linenos" data-linenos="15 "></span>    public function index()
<span class="linenos" data-linenos="16 "></span>    {
<span class="linenos" data-linenos="17 "></span>        //
<span class="linenos" data-linenos="18 "></span>    }
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>    /**
<span class="linenos" data-linenos="21 "></span>     * Show the form for creating a new resource.
<span class="linenos" data-linenos="22 "></span>     *
<span class="linenos" data-linenos="23 "></span>     * @return \Illuminate\Http\Response
<span class="linenos" data-linenos="24 "></span>     */
<span class="linenos" data-linenos="25 "></span>    public function create()
<span class="linenos" data-linenos="26 "></span>    {
<span class="linenos" data-linenos="27 "></span>        //
<span class="linenos" data-linenos="28 "></span>    }
<span class="linenos" data-linenos="29 "></span>
<span class="linenos" data-linenos="30 "></span>    /**
<span class="linenos" data-linenos="31 "></span>     * Store a newly created resource in storage.
<span class="linenos" data-linenos="32 "></span>     *
<span class="linenos" data-linenos="33 "></span>     * @param  \Illuminate\Http\Request  $request
<span class="linenos" data-linenos="34 "></span>     * @return \Illuminate\Http\Response
<span class="linenos" data-linenos="35 "></span>     */
<span class="linenos" data-linenos="36 "></span>    public function store(Request $request)
<span class="linenos" data-linenos="37 "></span>    {
<span class="linenos" data-linenos="38 "></span>        //
<span class="linenos" data-linenos="39 "></span>    }
<span class="linenos" data-linenos="40 "></span>
<span class="linenos" data-linenos="41 "></span>    /**
<span class="linenos" data-linenos="42 "></span>     * Display the specified resource.
<span class="linenos" data-linenos="43 "></span>     *
<span class="linenos" data-linenos="44 "></span>     * @param  int  $id
<span class="linenos" data-linenos="45 "></span>     * @return \Illuminate\Http\Response
<span class="linenos" data-linenos="46 "></span>     */
<span class="linenos" data-linenos="47 "></span>    public function show($id)
<span class="linenos" data-linenos="48 "></span>    {
<span class="linenos" data-linenos="49 "></span>        //
<span class="linenos" data-linenos="50 "></span>    }
<span class="linenos" data-linenos="51 "></span>
<span class="linenos" data-linenos="52 "></span>    /**
<span class="linenos" data-linenos="53 "></span>     * Show the form for editing the specified resource.
<span class="linenos" data-linenos="54 "></span>     *
<span class="linenos" data-linenos="55 "></span>     * @param  int  $id
<span class="linenos" data-linenos="56 "></span>     * @return \Illuminate\Http\Response
<span class="linenos" data-linenos="57 "></span>     */
<span class="linenos" data-linenos="58 "></span>    public function edit($id)
<span class="linenos" data-linenos="59 "></span>    {
<span class="linenos" data-linenos="60 "></span>        //
<span class="linenos" data-linenos="61 "></span>    }
<span class="linenos" data-linenos="62 "></span>
<span class="linenos" data-linenos="63 "></span>    /**
<span class="linenos" data-linenos="64 "></span>     * Update the specified resource in storage.
<span class="linenos" data-linenos="65 "></span>     *
<span class="linenos" data-linenos="66 "></span>     * @param  \Illuminate\Http\Request  $request
<span class="linenos" data-linenos="67 "></span>     * @param  int  $id
<span class="linenos" data-linenos="68 "></span>     * @return \Illuminate\Http\Response
<span class="linenos" data-linenos="69 "></span>     */
<span class="linenos" data-linenos="70 "></span>    public function update(Request $request, $id)
<span class="linenos" data-linenos="71 "></span>    {
<span class="linenos" data-linenos="72 "></span>        //
<span class="linenos" data-linenos="73 "></span>    }
<span class="linenos" data-linenos="74 "></span>
<span class="linenos" data-linenos="75 "></span>    /**
<span class="linenos" data-linenos="76 "></span>     * Remove the specified resource from storage.
<span class="linenos" data-linenos="77 "></span>     *
<span class="linenos" data-linenos="78 "></span>     * @param  int  $id
<span class="linenos" data-linenos="79 "></span>     * @return \Illuminate\Http\Response
<span class="linenos" data-linenos="80 "></span>     */
<span class="linenos" data-linenos="81 "></span>    public function destroy($id)
<span class="linenos" data-linenos="82 "></span>    {
<span class="linenos" data-linenos="83 "></span>        //
<span class="linenos" data-linenos="84 "></span>    }
<span class="linenos" data-linenos="85 "></span>}
</code></pre></div>
<p>Ara crearem la ruta per a accedir al nostre controlador.
Hem d'obrir l'arxiu routes/api.php i agregarem la ruta de la següent forma:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>Route::resource(&#39;movie&#39;, &#39;Api\MovieController&#39;);
</code></pre></div>
<p>Laravel configurarà les rutes per als verbs http que vulguem usar, com <strong>GET, POST, PUT, PATCH i DELETE</strong>. Si seguim l'estructura definida en aquesta llista, no hi ha per on perdre's.
Crearem una pelicula amb una petició POST, i després demanarem una pelicula usant GET. 
Primer, per a guardar dades, si ens fixem en la llista de rutes, el verb POST està associat amb api/movie, i amb el mètode movie.store.
Segon, per a mostrar les dades, el mètode <strong>GET</strong> està associat amb api/movie/{movie}, i amb el mètode movie.show.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>public function store(Request $request)
<span class="linenos" data-linenos=" 2 "></span>{
<span class="linenos" data-linenos=" 3 "></span>    $movie = new Movie();
<span class="linenos" data-linenos=" 4 "></span>    $movie-&gt;fill($request-&gt;toArray());
<span class="linenos" data-linenos=" 5 "></span>    $movie-&gt;save();
<span class="linenos" data-linenos=" 6 "></span>}
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>public function show($id)
<span class="linenos" data-linenos=" 9 "></span>{
<span class="linenos" data-linenos="10 "></span>    //Solicitamos al modelo el Pokemon con el id solicitado por GET.
<span class="linenos" data-linenos="11 "></span>    return Movie::where(&#39;id&#39;, $id)-&gt;get();
<span class="linenos" data-linenos="12 "></span>}
</code></pre></div>
<p>I ara ho provem amb Postman:</p>
<p><img alt="" src="../img/api08.png" /></p>
<p><img alt="" src="../img/api09.png" /></p>
<h3 id="api-resources">API Resources<a class="headerlink" href="#api-resources" title="Permanent link">&para;</a></h3>
<p>Podem utilitzar esta funcionalitat de Eloquent per a filtrar la informació que li oferim a l'usuari de la API</p>
<p>Així per a crer un API Resource utilitzarem l'artisan:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php artisan make:resource MovieResource
</code></pre></div>
<p>que crearà un fitxer MovieResource en la carpeta Resource de http</p>
<p>Ara canviarem el controlador per a que pase através d'este recurs:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>public function index()
<span class="linenos" data-linenos="2 "></span>{
<span class="linenos" data-linenos="3 "></span>    return MovieResource::collection(Movie::all());
<span class="linenos" data-linenos="4 "></span>}
</code></pre></div>
<p>I modificarem el resource per a que torne uns camps específics</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>class MovieResource extends JsonResource
<span class="linenos" data-linenos=" 2 "></span>{
<span class="linenos" data-linenos=" 3 "></span>    /**
<span class="linenos" data-linenos=" 4 "></span>     * Transform the resource into an array.
<span class="linenos" data-linenos=" 5 "></span>     *
<span class="linenos" data-linenos=" 6 "></span>     * @param  \Illuminate\Http\Request  $request
<span class="linenos" data-linenos=" 7 "></span>     * @return array
<span class="linenos" data-linenos=" 8 "></span>     */
<span class="linenos" data-linenos=" 9 "></span>    public function toArray($request)
<span class="linenos" data-linenos="10 "></span>    {
<span class="linenos" data-linenos="11 "></span>    //return parent::toArray($request);
<span class="linenos" data-linenos="12 "></span>    return [
<span class="linenos" data-linenos="13 "></span>        &#39;id&#39; =&gt; $this-&gt;id,
<span class="linenos" data-linenos="14 "></span>        &#39;title&#39; =&gt; $this-&gt;title,
<span class="linenos" data-linenos="15 "></span>        &#39;year&#39; =&gt; $this-&gt;year,
<span class="linenos" data-linenos="16 "></span>        &#39;genere&#39; =&gt; $this-&gt;descGenre,
<span class="linenos" data-linenos="17 "></span>    ];
<span class="linenos" data-linenos="18 "></span>    }
<span class="linenos" data-linenos="19 "></span>}
</code></pre></div>
<p>I ja ho tenim. Ara tots els resultats vindran filtrats per la funció toArray del Resource.</p>
<h3 id="autenticacio-installa-el-paquet-dautenticacio-api-passport">Autenticació: Instal·la el paquet d'autenticació API — Passport<a class="headerlink" href="#autenticacio-installa-el-paquet-dautenticacio-api-passport" title="Permanent link">&para;</a></h3>
<p>Aquest paquet és fonamental ja que, com el seu nom l'indica, Laravel posseeix un sistema tradicional d'autenticació mitjançant token però, per al cas del desenvolupament d'una API, Laravel ofereix una cosa específica. <strong>Laravel Passport</strong>.</p>
<p>Les APIs utilitzen típicament tokens per a autenticar usuaris però no per a mantindre les sessions entre els requests. Laravel ajuda al fet que l'autenticació a través de la API siga molt simple amb Laravel Passport, sistema que proveeix una implementació total de OAuth2 per a la teua aplicació de Laravel.</p>
<p>Seguirem els passos indicats en la <a href="https://laravel.com/docs/6.0/passport">documentació oficial</a></p>
<ul>
<li>
<p>Comença la instal·lació a través del manejador de paquets, composer, a través del comando:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>composer require laravel/passport
</code></pre></div>
</li>
<li>
<p>Realitza la migració</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php artisan migrate
</code></pre></div>
</li>
</ul>
<p><img alt="" src="../img/api01.png" /></p>
<p>La migració generarà les taules que necessitarà la teua aplicació per a emmagatzemar els clients i els seus token d'accés. </p>
<p><img alt="" src="../img/api02.png" /></p>
<h4 id="installacio-i-generacio-de-les-claus">Instal·lació i generació de les claus<a class="headerlink" href="#installacio-i-generacio-de-les-claus" title="Permanent link">&para;</a></h4>
<p>Després, has d'executar el comando <strong>passport:install</strong>. Aquest comando crearà les claus d'encriptació necessàries per a generar els tokens d'accés. Addicionalment el comando crearà el “personal access” i “password grant” dels clients que s'usaran per a generar els tokens d'accés:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php artisan passport:install
</code></pre></div>
<h5 id="configurar-passport">Configurar Passport<a class="headerlink" href="#configurar-passport" title="Permanent link">&para;</a></h5>
<p>Després d'executar aquest comando, cal agregar el trait <strong>Laravel\Passport\HasApiTokens</strong> al model <strong>App\User</strong>. Aquest Trait proveeix alguns mètodes d'ajuda al teu model que et permetran inspeccionar al token i scope dels usuaris autenticats:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span> &lt;?php
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span> namespace App;
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span> use Laravel\Passport\HasApiTokens;
<span class="linenos" data-linenos=" 6 "></span> use Illuminate\Notifications\Notifiable;
<span class="linenos" data-linenos=" 7 "></span> use Illuminate\Foundation\Auth\User as Authenticatable;
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span> class User extends Authenticatable
<span class="linenos" data-linenos="10 "></span> {
<span class="linenos" data-linenos="11 "></span>    use HasApiTokens, Notifiable;
<span class="linenos" data-linenos="12 "></span>
<span class="linenos" data-linenos="13 "></span>     ...
<span class="linenos" data-linenos="14 "></span>}
</code></pre></div>
<p>Després el teu hauràs de cridar al mètode <strong>Passport::routes</strong> dins del mètode boot en la teua <strong>app/Providers/AuthServiceProvider</strong>. Aquest mètode registrarà les rutes necessàries per a emetre tokens d'accés i revocar tokens d'accés, clients i tokens d'accés personal:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>&lt;?php
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>namespace App\Providers;
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>use Laravel\Passport\Passport;
<span class="linenos" data-linenos=" 6 "></span>use Illuminate\Support\Facades\Gate;
<span class="linenos" data-linenos=" 7 "></span>use Illuminate\Foundation\Support\Providers\AuthServiceProvider as ServiceProvider;
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>class AuthServiceProvider extends ServiceProvider
<span class="linenos" data-linenos="10 "></span>{
<span class="linenos" data-linenos="11 "></span>    protected $policies = [
<span class="linenos" data-linenos="12 "></span>        &#39;App\Model&#39; =&gt; &#39;App\Policies\ModelPolicy&#39;,
<span class="linenos" data-linenos="13 "></span>    ];
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span>    public function boot()
<span class="linenos" data-linenos="16 "></span>    {
<span class="linenos" data-linenos="17 "></span>        $this-&gt;registerPolicies();
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span>        Passport::routes();
<span class="linenos" data-linenos="20 "></span>    }
<span class="linenos" data-linenos="21 "></span>}
</code></pre></div>
<p>Per a acabar en el teu arxiu de configuració <strong>config/auth.php</strong> hauràs d'ajustar l'opció del driver de l'autenticació de la api en el ‘guards’ a passport. Això li indicarà a la teua aplicació que use el TokenGuard de Passport en autenticar les sol·licituds API entrants:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>&#39;guards&#39; =&gt; [
<span class="linenos" data-linenos=" 2 "></span>    &#39;web&#39; =&gt; [
<span class="linenos" data-linenos=" 3 "></span>        &#39;driver&#39; =&gt; &#39;session&#39;,
<span class="linenos" data-linenos=" 4 "></span>        &#39;provider&#39; =&gt; &#39;users&#39;,
<span class="linenos" data-linenos=" 5 "></span>    ],
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    &#39;api&#39; =&gt; [
<span class="linenos" data-linenos=" 8 "></span>        &#39;driver&#39; =&gt; &#39;passport&#39;,
<span class="linenos" data-linenos=" 9 "></span>        &#39;provider&#39; =&gt; &#39;users&#39;,
<span class="linenos" data-linenos="10 "></span>    ],
<span class="linenos" data-linenos="11 "></span> ],
</code></pre></div>
<h5 id="creacio-de-les-rutes-de-la-api">Creació de les rutes de la API<a class="headerlink" href="#creacio-de-les-rutes-de-la-api" title="Permanent link">&para;</a></h5>
<p>A continuació el que es requereix és la creació de les rutes necessàries per a la teua api. Per a això has d'ingressar al servei de rutes que Laravel proveeix en forma exclusiva per a una api <strong>routes/api.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>&lt;?php
<span class="linenos" data-linenos=" 2 "></span>use Illuminate\Http\Request;
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span>Route::group([&#39;prefix&#39; =&gt; &#39;auth&#39;], function () {
<span class="linenos" data-linenos=" 5 "></span>    Route::post(&#39;login&#39;, &#39;Authcontroller@login&#39;);
<span class="linenos" data-linenos=" 6 "></span>    Route::post(&#39;signup&#39;, &#39;Authcontroller@signup&#39;);
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    Route::group([&#39;middleware&#39; =&gt; &#39;auth:api&#39;], function() {
<span class="linenos" data-linenos=" 9 "></span>        Route::get(&#39;logout&#39;, &#39;Authcontroller@logout&#39;);
<span class="linenos" data-linenos="10 "></span>        Route::get(&#39;user&#39;, &#39;Authcontroller@user&#39;);
<span class="linenos" data-linenos="11 "></span>    });
<span class="linenos" data-linenos="12 "></span>});
</code></pre></div>
<h5 id="creacio-del-controlador-per-a-lautenticacio">Creació del controlador per a l'autenticació<a class="headerlink" href="#creacio-del-controlador-per-a-lautenticacio" title="Permanent link">&para;</a></h5>
<p>En visualitzar les rutes que hem generat més amunt podràs notar que s'especifica un controlador que encara no hem creat. Per a això haurem de crear aquest controlador a través del comando:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php artisan make:controller AuthController
</code></pre></div>
<p>Després, haurem de crear cadascun dels mètodes que estem cridant:
signup / login / logout / user</p>
<p>Per a això escriurem dins del controlador el següent:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>&lt;?php
<span class="linenos" data-linenos=" 2 "></span>namespace App\Http\Controllers;
<span class="linenos" data-linenos=" 3 "></span>use App\User;
<span class="linenos" data-linenos=" 4 "></span>use Carbon\Carbon;
<span class="linenos" data-linenos=" 5 "></span>use Illuminate\Http\Request;
<span class="linenos" data-linenos=" 6 "></span>use Illuminate\Support\Facades\Auth;
<span class="linenos" data-linenos=" 7 "></span>class AuthController extends Controller
<span class="linenos" data-linenos=" 8 "></span>{
<span class="linenos" data-linenos=" 9 "></span>    public function signup(Request $request)
<span class="linenos" data-linenos="10 "></span>    {
<span class="linenos" data-linenos="11 "></span>        $request-&gt;validate([
<span class="linenos" data-linenos="12 "></span>            &#39;name&#39;     =&gt; &#39;required|string&#39;,
<span class="linenos" data-linenos="13 "></span>            &#39;email&#39;    =&gt; &#39;required|string|email|unique:users&#39;,
<span class="linenos" data-linenos="14 "></span>            &#39;password&#39; =&gt; &#39;required|string|confirmed&#39;,
<span class="linenos" data-linenos="15 "></span>        ]);
<span class="linenos" data-linenos="16 "></span>        $user = new User([
<span class="linenos" data-linenos="17 "></span>            &#39;name&#39;     =&gt; $request-&gt;name,
<span class="linenos" data-linenos="18 "></span>            &#39;email&#39;    =&gt; $request-&gt;email,
<span class="linenos" data-linenos="19 "></span>            &#39;password&#39; =&gt; bcrypt($request-&gt;password),
<span class="linenos" data-linenos="20 "></span>        ]);
<span class="linenos" data-linenos="21 "></span>        $user-&gt;save();
<span class="linenos" data-linenos="22 "></span>        return response()-&gt;json([
<span class="linenos" data-linenos="23 "></span>            &#39;message&#39; =&gt; &#39;Successfully created user!&#39;], 201);
<span class="linenos" data-linenos="24 "></span>    }
<span class="linenos" data-linenos="25 "></span>
<span class="linenos" data-linenos="26 "></span>    public function login(Request $request)
<span class="linenos" data-linenos="27 "></span>    {
<span class="linenos" data-linenos="28 "></span>        $request-&gt;validate([
<span class="linenos" data-linenos="29 "></span>            &#39;email&#39;       =&gt; &#39;required|string|email&#39;,
<span class="linenos" data-linenos="30 "></span>            &#39;password&#39;    =&gt; &#39;required|string&#39;,
<span class="linenos" data-linenos="31 "></span>            &#39;remember_me&#39; =&gt; &#39;boolean&#39;,
<span class="linenos" data-linenos="32 "></span>        ]);
<span class="linenos" data-linenos="33 "></span>        $credentials = request([&#39;email&#39;, &#39;password&#39;]);
<span class="linenos" data-linenos="34 "></span>        if (!Auth::attempt($credentials)) {
<span class="linenos" data-linenos="35 "></span>            return response()-&gt;json([
<span class="linenos" data-linenos="36 "></span>                &#39;message&#39; =&gt; &#39;Unauthorized&#39;], 401);
<span class="linenos" data-linenos="37 "></span>        }
<span class="linenos" data-linenos="38 "></span>        $user = $request-&gt;user();
<span class="linenos" data-linenos="39 "></span>        $tokenResult = $user-&gt;createToken(&#39;Personal Access Token&#39;);
<span class="linenos" data-linenos="40 "></span>        $token = $tokenResult-&gt;token;
<span class="linenos" data-linenos="41 "></span>        if ($request-&gt;remember_me) {
<span class="linenos" data-linenos="42 "></span>            $token-&gt;expires_at = Carbon::now()-&gt;addWeeks(1);
<span class="linenos" data-linenos="43 "></span>        }
<span class="linenos" data-linenos="44 "></span>        $token-&gt;save();
<span class="linenos" data-linenos="45 "></span>        return response()-&gt;json([
<span class="linenos" data-linenos="46 "></span>            &#39;access_token&#39; =&gt; $tokenResult-&gt;accessToken,
<span class="linenos" data-linenos="47 "></span>            &#39;token_type&#39;   =&gt; &#39;Bearer&#39;,
<span class="linenos" data-linenos="48 "></span>            &#39;expires_at&#39;   =&gt; Carbon::parse(
<span class="linenos" data-linenos="49 "></span>                $tokenResult-&gt;token-&gt;expires_at)
<span class="linenos" data-linenos="50 "></span>                    -&gt;toDateTimeString(),
<span class="linenos" data-linenos="51 "></span>        ]);
<span class="linenos" data-linenos="52 "></span>    }
<span class="linenos" data-linenos="53 "></span>
<span class="linenos" data-linenos="54 "></span>    public function logout(Request $request)
<span class="linenos" data-linenos="55 "></span>    {
<span class="linenos" data-linenos="56 "></span>        $request-&gt;user()-&gt;token()-&gt;revoke();
<span class="linenos" data-linenos="57 "></span>        return response()-&gt;json([&#39;message&#39; =&gt; 
<span class="linenos" data-linenos="58 "></span>            &#39;Successfully logged out&#39;]);
<span class="linenos" data-linenos="59 "></span>    }
<span class="linenos" data-linenos="60 "></span>
<span class="linenos" data-linenos="61 "></span>    public function user(Request $request)
<span class="linenos" data-linenos="62 "></span>    {
<span class="linenos" data-linenos="63 "></span>        return response()-&gt;json($request-&gt;user());
<span class="linenos" data-linenos="64 "></span>    }
<span class="linenos" data-linenos="65 "></span>}
</code></pre></div>
<p>Per a les proves, podem utilitzar <a href="https://www.getpostman.com/">Postman</a> (té opció per a extensió en chrome o com a app). Per a la correcta utilització, cal configurar les següents dues capçaleres:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>Content-Type: application/json
<span class="linenos" data-linenos="2 "></span>X-Requested-With: XMLHttpRequest
</code></pre></div>
<p><img alt="" src="../img/api03.png" />   </p>
<p><strong>Creació usuari</strong></p>
<p><img alt="" src="../img/api07.png" /></p>
<p><strong>login</strong></p>
<p><img alt="" src="../img/api06.png" /></p>
<p><strong>visualització usuari</strong></p>
<p><img alt="" src="../img/api05.png" /></p>
<p><strong>logout</strong> </p>
<p><img alt="" src="../img/api04.png" /></p>
<p>Per a que la api de movies funcione quan estic autenticat cal possar-la dins del  grup de rutes autenticades en el fitxer de rutes <strong>api.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>Route::group([&#39;prefix&#39; =&gt; &#39;auth&#39;], function () {
<span class="linenos" data-linenos=" 2 "></span>    Route::post(&#39;login&#39;, &#39;Authcontroller@login&#39;);
<span class="linenos" data-linenos=" 3 "></span>    Route::post(&#39;signup&#39;, &#39;Authcontroller@signup&#39;);
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    Route::group([&#39;middleware&#39; =&gt; &#39;auth:api&#39;], function() {
<span class="linenos" data-linenos=" 6 "></span>        Route::get(&#39;logout&#39;, &#39;Authcontroller@logout&#39;);
<span class="linenos" data-linenos=" 7 "></span>        Route::get(&#39;user&#39;, &#39;Authcontroller@user&#39;);
<span class="linenos" data-linenos=" 8 "></span>        Route::resource(&#39;movie&#39;, &#39;Api\MovieController&#39;);
<span class="linenos" data-linenos=" 9 "></span>    });
<span class="linenos" data-linenos="10 "></span>});
</code></pre></div>
<p>Podeu aprofundir més en aquest <a href="https://medium.com/@cvallejo/sistema-de-autenticación-api-rest-con-laravel-5-6-572a16e3929b">enllaç</a></p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2024 Xavier Sastre - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "toc.integrate", "content.tabs.link", "navigation.expand"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiat al porta-retalls", "clipboard.copy": "C\u00f2pia al porta-retalls", "search.result.more.one": "1 m\u00e9s en aquesta p\u00e0gina", "search.result.more.other": "# m\u00e9s en aquesta p\u00e0gina", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.term.missing": "Desaparegut", "select.version": "Selecciona la versi\u00f3"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>