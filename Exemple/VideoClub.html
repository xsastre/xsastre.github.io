
<!doctype html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://xsastre.github.io/Exemple/VideoClub.html">
      
      
      
      
      <link rel="icon" href="../imagenes/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.9">
    
    
      
        <title>Exemple - Docencia Xavier</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans+Condensed:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"IBM Plex Sans Condensed";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#exemple" class="md-skip">
          Salta el contingut
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Capçalera">
    <a href=".." title="Docencia Xavier" class="md-header__button md-logo" aria-label="Docencia Xavier" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Docencia Xavier
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Exemple
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Canviar a mode dia"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Canviar a mode dia" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Neteja" aria-label="Neteja" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicialitzant cerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegació" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Docencia Xavier" class="md-nav__button md-logo" aria-label="Docencia Xavier" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Docencia Xavier
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Inici
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Inici
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inici
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DWEC
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            DWEC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Moduls/DWEC/_DWEC2425.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Desenvolupament web en entorn client - DAW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Moduls/DWEC/desenvolupamentfrontend.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Desenvolupamet frontend
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AW
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            AW
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Moduls/AW/01.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aplicacions web
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="exemple">Exemple<a class="headerlink" href="#exemple" title="Permanent link">&para;</a></h1>
<h2 id="videoclub">Videoclub<a class="headerlink" href="#videoclub" title="Permanent link">&para;</a></h2>
<p>Com a exemple anem a desenvolupar una xicoteta web per a la gestió interna d'un videoclub, començarem per definir les rutes i vistes del lloc i a poc a poc en els següents exercicis l'anirem completant fins a acabar el lloc web complet.</p>
<p>L'objectiu és realitzar un lloc web per a la gestió interna en un videoclub, el qual estarà protegit mitjançant usuari i contrasenya. Una vegada autoritzat l'accés, l'usuari podrà llistar el catàleg de pel·lícules, veure informació detallada d'una pel·lícula, realitzar cerques o filtrats i algunes operacions més de gestió.</p>
<h3 id="definicio-de-les-rutes">Definició de les rutes<a class="headerlink" href="#definicio-de-les-rutes" title="Permanent link">&para;</a></h3>
<p><a href="https://youtu.be/tQuMBNMA-kc"><img alt="" src="../../img/ull.png" />Video</a></p>
<p>En aquest exercici anem a definir les rutes principals que va a tenir el nostre lloc web. Per a començar simplement indicarem que les rutes retornen una cadena (així podrem comprovar que s'han creat correctament). A continuació s'inclou una taula amb les rutes a definir (totes de tipus  GET) i el text que han de mostrar:</p>
<table>
<thead>
<tr>
<th>Ruta</th>
<th>Text a mostrar</th>
</tr>
</thead>
<tbody>
<tr>
<td>/</td>
<td>Pantalla principal</td>
</tr>
<tr>
<td>login</td>
<td>Login usuari</td>
</tr>
<tr>
<td>logout</td>
<td>Logout usuari</td>
</tr>
<tr>
<td>catalog</td>
<td>Llistat pel·lícules</td>
</tr>
<tr>
<td>catalog/show/{id}</td>
<td id="id">Vista detall pel·lícula</td>
</tr>
<tr>
<td>catalog/create</td>
<td>Afegir pel·lícula</td>
</tr>
<tr>
<td>catalog/edit/{id}</td>
<td id="id">Modificar pel·lícula</td>
</tr>
</tbody>
</table>
<h5 id="solucio">Solució:<a class="headerlink" href="#solucio" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">   Route::get(&#39;/&#39;, function () { return &#39;Pagina principal&#39;;});</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    Route::get(&#39;login&#39;, function () { return &#39;Login usuari&#39;;});</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    Route::get(&#39;logout&#39;, function () { return &#39;Logout usuari&#39;;});</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    Route::get(&#39;catalog&#39;, function () { return &#39;Llistat pel.licules&#39;;});</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    Route::get(&#39;catalog/show/{id}&#39;, function () { return &quot;Vista detall pel.licula $id&quot;;});</span>
<span class="linenos" data-linenos="6 "></span><span class="x">    Route::get(&#39;catalog/create&#39;, function () { return &#39;Afegir pel.licula&#39;;});</span>
<span class="linenos" data-linenos="7 "></span><span class="x">    Route::get(&#39;catalog/edit/{id}&#39;, function () {return &quot;Modificar pel.licula $id&quot;;});</span>
</code></pre></div>
<p>Per a comprovar que les rutes s'hagen creat correctament utilitza el comando de  artisan que retorna un llistat de rutes i a més prova també les rutes en el navegador.</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">php artisan route:list</span>
</code></pre></div>
<img alt="" src="../../img/ls01.png" /></p>
<h3 id="layout-principal-de-les-vistes-amb-bootstrap">Layout principal de les vistes amb  Bootstrap<a class="headerlink" href="#layout-principal-de-les-vistes-amb-bootstrap" title="Permanent link">&para;</a></h3>
<p>En aquest exercici anem a crear el  layout base que van a utilitzar la resta de vistes del lloc web i a més inclourem la llibreria  Bootstrap per a utilitzar-la com a estil base.
Laravel 5.8 ja inclou bootstrap però laravel 6.0 no. Així que cal instalar-lo:</p>
<ul>
<li>Fes <strong>composer require laravel/ui</strong></li>
<li>
<p>Despres <strong>php artisan ui bootstrap</strong></p>
</li>
<li>
<p>Fes <strong>npm install</strong> des de la linea de comanaments. Acò instal.larà tots els paquets que estàn en el packaje.son en el directori <strong>node_modules</strong></p>
</li>
<li>
<p>Fes <strong>npm run-dev</strong> des de la linea de comanaments. Aço compilarà totes les dependències i les ficarà en els fitxers <strong>public/css/app.cs</strong> i <strong>public/js/app.js</strong>. </p>
</li>
</ul>
<p>Dels materials que ens hem descarregat copiem la plantilla per a la barra de navegació principal (navbar.blade.php) i l'emmagatzemem en la carpeta  resources/views/partials.
A continuació anem a crear el <strong>layout principal</strong> del nostre lloc:</p>
<ul>
<li>Anem a crear el fitxer <strong>resources/views/layouts/master.blade.php</strong>.</li>
<li>Li afegim com contingut la plantilla base HTML que proposa  Bootstrap en la seua <a href="https://getbootstrap.com/docs/4.4/getting-started/introduction/">documentació</a>
, modificant els següents elements:</li>
<li>
<p>Canviem les rutes per a la càrrega dels  assets que venen en laravel per defecte. Per a generar la ruta completa i que trobe els recursos haurem d'escriure els següents comandos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>    .....
<span class="linenos" data-linenos="2 "></span>    &lt;!-- Bootstrap --&gt;
<span class="linenos" data-linenos="3 "></span>    &lt;meta name=&quot;csrf-token&quot; content=&quot;{{ &quot;{{ csrf_token() &quot; }}}}&quot;&gt;
<span class="linenos" data-linenos="4 "></span>    &lt;link href=&quot;{{ &quot;{{ asset(&#39;css/app.css&#39;) &quot; }}}}&quot; rel=&quot;stylesheet&quot;&gt;
<span class="linenos" data-linenos="5 "></span>    .....
<span class="linenos" data-linenos="6 "></span>    &lt;script src=&quot;{{ &quot;{{ asset(&#39;js/app.js&#39;) &quot; }}}}&quot; &gt;&lt;/script&gt;
</code></pre></div>
</li>
<li>
<p>Dins de la secció <body> de l'HTML, eliminem el text que ve d'exemple (\<h1> Hello,  world! \</h1>) i incloem la barra de navegació que hem guardat abans utilitzant el següent codi:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>@include(&#39;partials.navbar&#39;)
</code></pre></div>
</li>
<li>
<p>A continuació de la barra de navegació afegim la secció principal on apareixerà el contingut de la web:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>&lt;div class=&quot;container&quot;&gt; @yield(&#39;content&#39;)&lt;/div&gt;
</code></pre></div>
</li>
</ul>
<p>Amb açò ja hem definit el layout principal, no obstant açò encara no podem provar-ho ja que no està associat a cap ruta. </p>
<h5 id="solucio_1">Solució:<a class="headerlink" href="#solucio_1" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    &lt;html lang=&quot;es&quot;&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">      &lt;head&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">        &lt;meta charset=&quot;utf-8&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">        &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">        &lt;!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags --&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        &lt;title&gt;Video Club&lt;/title&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        &lt;meta name=&quot;csrf-token&quot; content=&quot;{{ &quot;{{ csrf_token() &quot; }}}}&quot;&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="x">        &lt;!-- Bootstrap --&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">         &lt;link href=&quot;{{ &quot;{{ asset(&#39;css/app.css&#39;) &quot; }}}}&quot; rel=&quot;stylesheet&quot;&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">      &lt;/head&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">      &lt;body&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">        @include(&#39;partials.navbar&#39;)</span>
<span class="linenos" data-linenos="15 "></span><span class="x">        &lt;div id=&#39;app&#39; class=&quot;container&quot;&gt; @yield(&#39;content&#39;)&lt;/div&gt;</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span><span class="x">        &lt;!-- Scripts --&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x">        &lt;script src=&quot;{{ &quot;{{ asset(&#39;js/app.js&#39;) &quot; }}}}&quot; &gt;&lt;/script&gt;</span>
<span class="linenos" data-linenos="19 "></span><span class="x">      &lt;/body&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">    &lt;/html&gt;</span>
</code></pre></div>
<h3 id="crear-la-resta-de-vistes">Crear la resta de vistes<a class="headerlink" href="#crear-la-resta-de-vistes" title="Permanent link">&para;</a></h3>
<p>En aquest exercici anem acabar una primera versió estable de la web. En primer lloc crearem les vistes associades a cada ruta, les quals hauran d'estendre del  layout que hem fet en l'exercici anterior i mostrar (en la secció de  content del  layout) el text d'exemple que havíem definit per a cada ruta en l'exercici 2.
En general totes les vistes tindran un codi similar al següent (variant únicament la secció  content):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>@extends(&#39;layouts.master&#39;)
<span class="linenos" data-linenos="2 "></span>@section(&#39;content&#39;)
<span class="linenos" data-linenos="3 "></span>    Pantalla principal 
<span class="linenos" data-linenos="4 "></span>@stop
</code></pre></div>
<p>Per a organitzar millor les vistes les anem a agrupar en  sub-carpetes dins de la carpeta  resources/views seguint la següent estructura:</p>
<table>
<thead>
<tr>
<th>Vista</th>
<th>Carpeta</th>
<th>Ruta associada</th>
</tr>
</thead>
<tbody>
<tr>
<td>home.blade.php</td>
<td>resources/views/</td>
<td>/</td>
</tr>
<tr>
<td>login.blade.php</td>
<td>resources/views/auth/</td>
<td>login</td>
</tr>
<tr>
<td>index.blade.php</td>
<td>resources/views/catalog/</td>
<td>catalog</td>
</tr>
<tr>
<td>show.blade.php</td>
<td>resources/views/catalog/</td>
<td>catalog/show/{ id}</td>
</tr>
<tr>
<td>create.blade.php</td>
<td>resources/views/catalog/</td>
<td>catalog/ create</td>
</tr>
<tr>
<td>edit.blade.php</td>
<td>resources/views/catalog/</td>
<td>catalog/edit/{id}</td>
</tr>
</tbody>
</table>
<p>Creem una vista separada per a totes les rutes excepte para la ruta " logout", la qual no tindrà cap vista.
Finalment anem a actualitzar les rutes del fitxer  routes/web.php perquè es carreguen les vistes que acabem de crear. Acordar-vos que per a referenciar les vistes que estan dins de carpetes la barra / de separació es transforma en un punt, i que a més, com a segon paràmetre, podem passar dades a la vista. A continuació s'inclouen alguns exemples:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>return view(&#39;home&#39;);
<span class="linenos" data-linenos="2 "></span>return view(&#39;catalog.index&#39;);
<span class="linenos" data-linenos="3 "></span>return view(&#39;catalog.show&#39;,array(&#39;id&#39;=&gt;$id));
</code></pre></div>
<p>Una vegada fets aquests canvis ja podem provar-ho en el navegador, el qual hauria de mostrar en tots els casos la plantilla base amb la barra de navegació principal i els estils de  Bootstrap aplicats. En la secció principal de contingut de moment solament podrem veure els textos que hem posat d'exemple.</p>
<h5 id="solucio_2">Solució:<a class="headerlink" href="#solucio_2" title="Permanent link">&para;</a></h5>
<p>web.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    Route::get(&#39;/&#39;, function () { return view(&#39;home&#39;);});</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    Route::get(&#39;login&#39;, function () {return view(&#39;login&#39;);});</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    Route::get(&#39;logout&#39;, function () { return &#39;Logout usuari&#39;;});</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    Route::get(&#39;catalog&#39;, function () { return view(&#39;index&#39;);});</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    Route::get(&#39;catalog/show/{id}&#39;, function ($id) { return view(&#39;show&#39;,[&#39;pelicula&#39;=&gt;$id]);});</span>
<span class="linenos" data-linenos="6 "></span><span class="x">    Route::get(&#39;catalog/create&#39;, function () { return view(&#39;create&#39;);});</span>
<span class="linenos" data-linenos="7 "></span><span class="x">    Route::get(&#39;catalog/edit/{id}&#39;, function ($id) {return view(&#39;edit&#39;,[&#39;pelicula&#39; =&gt;$id]);});</span>
</code></pre></div>
<p>edit.blade</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    @extends(&#39;layouts.master&#39;)</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    @section(&#39;content&#39;)</span>
<span class="linenos" data-linenos="3 "></span><span class="x">        Editar pel.licula id {{ &quot;{{$pelicula&quot; }}}}</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    @stop</span>
</code></pre></div>
<p>show.blade</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    @extends(&#39;layouts.master&#39;)</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    @section(&#39;content&#39;)</span>
<span class="linenos" data-linenos="3 "></span><span class="x">        Mostrar pel.licula id {{ &quot;{{$pelicula&quot; }}}}</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    @stop</span>
</code></pre></div>
<p>create.blade</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    @extends(&#39;layouts.master&#39;)</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    @section(&#39;content&#39;)</span>
<span class="linenos" data-linenos="3 "></span><span class="x">        Crear pel.licula </span>
<span class="linenos" data-linenos="4 "></span><span class="x">    @stop</span>
</code></pre></div>
<p>home.blade</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    @extends(&#39;layouts.master&#39;)</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    @section(&#39;content&#39;)</span>
<span class="linenos" data-linenos="3 "></span><span class="x">        Pagina principal </span>
<span class="linenos" data-linenos="4 "></span><span class="x">    @stop</span>
</code></pre></div>
<p>index.blade</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    @extends(&#39;layouts.master&#39;)</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    @section(&#39;content&#39;)</span>
<span class="linenos" data-linenos="3 "></span><span class="x">        Catalogo</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    @stop</span>
</code></pre></div>
<p>login.blade</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    @extends(&#39;layouts.master&#39;)</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    @section(&#39;content&#39;)</span>
<span class="linenos" data-linenos="3 "></span><span class="x">        Login</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    @stop</span>
</code></pre></div>
<p><img alt="" src="../../img/ls02.png" /></p>
<h3 id="crear-les-proves">Crear les proves<a class="headerlink" href="#crear-les-proves" title="Permanent link">&para;</a></h3>
<p>Crea un fitxer de proves en la consola del  artisan</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php artisan make:test BasicTest
</code></pre></div>
<p>Crea un prova per a  comprobrar que va la pantalla d'inici:</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">public function testLoadHomePage(){ </span>
<span class="linenos" data-linenos="2 "></span><span class="x">    $this-&gt;get(&#39;/&#39;)-&gt;assertStatus(200)-&gt;assertSee(&#39;Pantalla principal&#39;);</span>
<span class="linenos" data-linenos="3 "></span><span class="x">}</span>
</code></pre></div>
Comprova totes les vistes:</p>
<h5 id="solucio_3">Solució<a class="headerlink" href="#solucio_3" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">class BasicTest extends TestCase</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">    public function testLoadHomePage(){ </span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">        $this-&gt;get(&#39;/&#39;)-&gt;assertStatus(200)-&gt;assertSee(&#39;Pantalla principal&#39;);</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    }</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    public function testLoadCatalogPage(){ </span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">        $this-&gt;get(&#39;/catalog&#39;)-&gt;assertStatus(200)-&gt;assertSee(&#39;Catalogo&#39;);</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    }</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">    public function testLoadCreatePage(){ </span>
<span class="linenos" data-linenos="10 "></span><span class="x">        $this-&gt;get(&#39;/catalog/create&#39;)-&gt;assertStatus(200)-&gt;assertSee(&#39;Crear pel.licula&#39;);</span>
<span class="linenos" data-linenos="11 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="12 "></span><span class="x">    public function testLoadEditPage(){ </span>
<span class="linenos" data-linenos="13 "></span><span class="x">        $this-&gt;get(&#39;/catalog/edit/2&#39;)-&gt;assertStatus(200)-&gt;assertSee(&#39;Editar pel.licula id 2&#39;);</span>
<span class="linenos" data-linenos="14 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="15 "></span><span class="x">    public function testLoadShowPage(){ </span>
<span class="linenos" data-linenos="16 "></span><span class="x">        $this-&gt;get(&#39;/catalog/show/2&#39;)-&gt;assertStatus(200)-&gt;assertSee(&#39;Mostrar pel.licula id 2&#39;);</span>
<span class="linenos" data-linenos="17 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="18 "></span><span class="x">}</span>
</code></pre></div>
<p><img alt="" src="../../img/ls03.png" /></p>
<h3 id="definint-controladors">Definint Controladors<a class="headerlink" href="#definint-controladors" title="Permanent link">&para;</a></h3>
<p><a href="https://youtu.be/VwNTfrN8XTU"><img alt="" src="../../img/ull.png" />Video</a></p>
<p>En aquest primer exercici anem a crear els controladors necessaris per a gestionar la nostra aplicació i a més actualitzarem el fitxer de rutes perquè els utilitze.
Comencem per afegir els dos controladors que ens van a fer falta: <strong>CatalogController.php</strong> i <strong>HomeController.php</strong>. 
Per a açò heu d'utilitzar el comando de Artisan que permet crear un controlador buit (sense mètodes).
A continuació anem a afegir els mètodes d'aquests controladors. En la següent taula resumeixen podem veure un llistat dels mètodes per controlador i les rutes que tindran associades:</p>
<table>
<thead>
<tr>
<th>Ruta</th>
<th>Controlador</th>
<th>Mètode</th>
</tr>
</thead>
<tbody>
<tr>
<td>/</td>
<td>HomeController</td>
<td>getHome</td>
</tr>
<tr>
<td>catalog</td>
<td>CatalogController</td>
<td>getIndex</td>
</tr>
<tr>
<td>catalog/show/{id}</td>
<td>CatalogController</td>
<td>getShow</td>
</tr>
<tr>
<td>catalog/create</td>
<td>CatalogController</td>
<td>getCreate</td>
</tr>
<tr>
<td>catalog/edit/{id}</td>
<td>CatalogController</td>
<td>getEdit</td>
</tr>
</tbody>
</table>
<p>Acordeu-vos que els mètodes getShow i getEdit hauran de rebre com a paràmetre el \$id de l'element a mostrar o editar, per la qual cosa la definició del mètode en el controlador haurà de ser com la següent:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>public function getShow($id) {
<span class="linenos" data-linenos="2 "></span>return view(&#39;catalog.show&#39;, array(&#39;id&#39;=&gt;$id)); }
</code></pre></div>
<p>Finalment anem a canviar el fitxer de rutes routes/web.php per tal que totes les rutes que teníem definides (excepte les de login i logout que les deixarem com estan) apunten als nous mètodes dels controladors, per exemple:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>Route::get(&#39;/&#39;, &#39;Homecontroller@gethome&#39;);
</code></pre></div>
<p>El codi que teníem posat per a cada ruta amb el return amb la generació de la vista ho heu de moure al mètode del controlador corresponent.</p>
<p>Comprova que les proves segueixen funcionant. En cas contrari corregeix les fallades.</p>
<p><strong>routes.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">Route::get(&#39;/&#39;,&#39;homeController@getHome&#39;);</span>
<span class="linenos" data-linenos="2 "></span><span class="x">Route::get(&#39;login&#39;, function () {return view(&#39;login&#39;);});</span>
<span class="linenos" data-linenos="3 "></span><span class="x">Route::get(&#39;logout&#39;, function () { return &#39;Logout usuari&#39;;});</span>
<span class="linenos" data-linenos="4 "></span><span class="x">Route::get(&#39;catalog&#39;,&#39;catalogController@getIndex&#39;);</span>
<span class="linenos" data-linenos="5 "></span><span class="x">Route::get(&#39;catalog/show/{id}&#39;, &#39;catalogController@getShow&#39;);</span>
<span class="linenos" data-linenos="6 "></span><span class="x">Route::get(&#39;catalog/create&#39;,&#39;catalogController@getCreate&#39;);</span>
<span class="linenos" data-linenos="7 "></span><span class="x">Route::get(&#39;catalog/edit/{id}&#39;,&#39;catalogController@getEdit&#39;);</span>
</code></pre></div>
<h5 id="renderitzant-les-vistes">Renderitzant les vistes<a class="headerlink" href="#renderitzant-les-vistes" title="Permanent link">&para;</a></h5>
<p><strong>catalogController.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">class</span> <span class="nc">catalogController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getIndex</span><span class="p">(){</span>
<span class="linenos" data-linenos=" 8 "></span>            <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getShow</span><span class="p">(</span><span class="nv">$id</span><span class="p">){</span>
<span class="linenos" data-linenos="11 "></span>            <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">,[</span><span class="s1">&#39;pelicula&#39;</span><span class="o">=&gt;</span><span class="nv">$id</span><span class="p">]);</span>
<span class="linenos" data-linenos="12 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getCreate</span><span class="p">(){</span>
<span class="linenos" data-linenos="14 "></span>            <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="16 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getEdit</span><span class="p">(</span><span class="nv">$id</span><span class="p">){</span>
<span class="linenos" data-linenos="17 "></span>            <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;edit&#39;</span><span class="p">,[</span><span class="s1">&#39;pelicula&#39;</span> <span class="o">=&gt;</span><span class="nv">$id</span><span class="p">]);</span>
<span class="linenos" data-linenos="18 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="19 "></span>    <span class="p">}</span>
</code></pre></div>
<p><strong>homeController.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">class</span> <span class="nc">homeController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getHome</span><span class="p">()</span>
<span class="linenos" data-linenos="10 "></span>        <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>            <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">action</span><span class="p">(</span><span class="s1">&#39;Catalogcontroller@getindex&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="12 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="completant-les-vistes">Completant les vistes<a class="headerlink" href="#completant-les-vistes" title="Permanent link">&para;</a></h3>
<p>En aquest exercici anem a acabar els mètodes dels controladors que hem creat en l'exercici anterior i a més completarem les vistes associades:</p>
<p><strong>Mètode Homecontroller@gethome</strong></p>
<p>En aquest mètode de moment solament anem a fer una redirecció a l'acció que mostra el llistat de pel·lícules del catàleg: </p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>return redirect()-&gt;action(&#39;Catalogcontroller@getindex&#39;);
</code></pre></div>
<p>Més endavant haurem de comprovar si l'usuari està logueado o no, i en cas que no l'aquest redirigir-li al formulari de login.</p>
<p><strong>Mètode CatalogController@index</strong></p>
<p>Aquest mètode ha de mostrar un llistat de totes les pel·lícules que té el videoclub. El llistat de pel·lícules ho podeu obtenir del fitxer array_peliculas.php facilitat amb els materials. Aquest array de pel·lícules ho heu de copiar com a variable membre de la classe (més endavant les emmagatzemarem en la base de dades). En el mètode del controlador simplement haurem de modificar la generació de la vista per a passar-li aquest array de pel·lícules complet (<strong>$this-&gt;arrayPeliculas</strong>).</p>
<p>I en la vista corresponent simplement haurem d'incloure el següent tros de codi en la seua secció content: </p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    &lt;div class=&quot;row&quot;&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">        @foreach( $arrayPeliculas as $key =&gt; $pelicula )        </span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">            &lt;div class=&quot;col-xs-6 col-sm-4 col-md-3 text-center&quot;&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">                &lt;a href=&quot;{{ &quot;{{  url(&#39;/catalog/show/&#39;.$key) &quot; }}}}&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">                    &lt;img src=&quot;{{ &quot;{{ $pelicula[&#39;poster&#39;]&quot; }}}}&quot; style=&quot;height:200px&quot;/&gt; </span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">                    &lt;h4 style=&quot;min-height:45px;margin:5px 0 10px 0&quot;&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">                    {{ &quot;{{ $pelicula[&#39;title&#39;]&quot; }}}} &lt;/h4&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">                &lt;/a&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">            &lt;/div&gt; </span>
<span class="linenos" data-linenos="10 "></span><span class="x">        @endforeach</span>
<span class="linenos" data-linenos="11 "></span><span class="x">    &lt;/div&gt;</span>
</code></pre></div>
<p>Com es pot veure en el codi, en primer lloc es crea una fila (usant el sistema de reixeta de Bootstrap) i a continuació es realitza un bucle foreach utilitzant la notació de Blade per a iterar per totes les pel·lícules. Per a cada pel·lícula obtenim la seua posició en el array i les seues dades associades, i generem una columna per a mostrar-los. </p>
<p>És important que ens fixem en com s'itera pels elements d'un array de dades i en la forma d'accedir als valors. A més s'ha inclòs un enllaç perquè en prémer sobre una pel·lícula ens porte a l'adreça <strong>/catalog/show/{\$key}</strong>, sent key la posició d'aqueixa pel·lícula en el array.</p>
<p><strong>Mètode Catalogcontroller@show</strong></p>
<p>Aquest mètode s'utilitza per a mostrar la vista detall d'una pel·lícula. Hem de tenir en compte que el mètode corresponent rep un identificador que (de moment) es refereix a la posició de la pel·lícula en el array. Per tant, haurem d'agafar aquesta pel·lícula del array ($this-&gt;arrayPeliculas[$id]) i passar-li-la a la vista.</p>
<p>En aquesta vista anem a crear dues columnes, la primera columna per a mostrar la imatge de la pel·lícula i la segona per a incloure tots els detalls. A continuació s'inclou l'estructura HTML que hauria de tenir aquesta pantalla:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="2 "></span>        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-sm-4&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="3 "></span>            {{ &quot;{{ -- TOT: Imatge de la pel·lícula --&quot; }}}}
<span class="linenos" data-linenos="4 "></span>        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="5 "></span>        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-sm-8&quot;</span><span class="p">&gt;</span>
<span class="linenos" data-linenos="6 "></span>            {{ &quot;{{ -- TOT: Dades de la pel·lícula --&quot; }}}}
<span class="linenos" data-linenos="7 "></span>        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span> 
<span class="linenos" data-linenos="8 "></span>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<p>En la columna de l'esquerra completem el TOT per a inserir la imatge de la pel·lícula. En la columna de la dreta s'hauran de mostrar totes les dades de la pel·lícula: títol, any, director, resum i el seu estat. </p>
<p>Per a mostrar l'estat de la pel·lícula consultarem el valor rented del array, el qual podrà tenir dos casos:</p>
<ul>
<li>En cas d'estar disponible (false) apareixerà l'estat "Pel·lícula disponible" i un botó blau per a "Llogar pel·lícula".</li>
<li>En cas d'estar llogada (true) apareixerà l'estat "Pel·lícula actualment llogada" i un botó roig per a "Retornar pel·lícula".</li>
</ul>
<p>A més hem d'incloure dos botons més, un botó que ens portarà a editar la pel·lícula i un altre per a tornar al llistat de pel·lícules.</p>
<p><strong>Nota</strong>: els botons de llogar/retornar de moment no han de funcionar. Acordeu-vos que en Bootstrap podem transformar un enllaç en un botó, simplement aplicant les classes "<strong>btn btn-default</strong>" (més info <a href="http://getbootstrap.com/css/#buttons">en</a>).
Aquesta pantalla finalment hauria de tenir una aparença similar a la següent:
  <img alt="" src="../../img/ls04.png" /></p>
<p><strong>Mètode Catalogcontroller@create</strong></p>
<p>Aquest mètode retorna la vista "catalog.create" per a afegir una nova pel·lícula. Per a crear aquest formulari en la vista corresponent ens podem basar en el contingut de la plantilla "catalog_create.php". Aquesta plantilla té una sèrie de ToDo's que cal completar. En total haurà de tenir els següents camps:</p>
<table>
<thead>
<tr>
<th>Label</th>
<th>Name</th>
<th>Tipus de camp</th>
</tr>
</thead>
<tbody>
<tr>
<td>Títol</td>
<td>title</td>
<td>text</td>
</tr>
<tr>
<td>Any</td>
<td>year</td>
<td>text</td>
</tr>
<tr>
<td>Director</td>
<td>director</td>
<td>text</td>
</tr>
<tr>
<td>Poster</td>
<td>poster</td>
<td>text</td>
</tr>
<tr>
<td>Resum</td>
<td>synopsis</td>
<td>textarea</td>
</tr>
</tbody>
</table>
<p>A més tindrà un botó al final amb el text "Afegir pel·lícula".
De moment el formulari no funcionarà. Més endavant ho acabarem.</p>
<p><strong>Mètode Catalogcontroller@edit</strong></p>
<p>Aquest mètode permetrà modificar el contingut d'una pel·lícula. El formulari serà exactament igual al d'afegir pel·lícula, així que ho podem copiar i pegar en aquesta vista i simplement canviar els següents punts:
* El títol per "Modificar pel·lícula".
* El text del botó d'enviament per "Modificar pel·lícula".
* Afegir just sota l'obertura del formulari el camp ocult per a indicar que es va a enviar per PUT.
Recordeu que Laravel inclou el mètode  <strong>@method('PUT')</strong> que ens ajudarà a fer açò.
De moment no haurem de fer res més, més endavant ho completarem perquè s'emplene amb les dades de la pel·lícula a editar.</p>
<p><strong>homeController.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">class</span> <span class="nc">HomeController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getHome</span><span class="p">(){</span>
<span class="linenos" data-linenos="10 "></span>            <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">action</span><span class="p">(</span><span class="s1">&#39;CatalogController@getIndex&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="11 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span>
</code></pre></div>
<p><strong>catalogController.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    ..</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    private $arrayPeliculas = ...</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    public function index(){</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">        return view(&#39;index&#39;,[&#39;arrayPeliculas&#39;=&gt;$this-&gt;arrayPeliculas]);</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    }</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    public function show($id){</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        $pelicula = $this-&gt;arrayPeliculas[$id];</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        return view(&#39;show&#39;,compact(&#39;pelicula&#39;,&#39;id&#39;));</span>
<span class="linenos" data-linenos="10 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="11 "></span><span class="x">    public function create(){</span>
<span class="linenos" data-linenos="12 "></span><span class="x">        return view(&#39;create&#39;);</span>
<span class="linenos" data-linenos="13 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="14 "></span><span class="x">    public function edit($id){</span>
<span class="linenos" data-linenos="15 "></span><span class="x">        return view(&#39;edit&#39;,[&#39;pelicula&#39; =&gt;$id]);</span>
<span class="linenos" data-linenos="16 "></span><span class="x">    }</span>
</code></pre></div>
<p><strong>show.blade.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    @extends(&#39;layouts.master&#39;)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    @section(&#39;content&#39;)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">        &lt;div class=&quot;row&quot;&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">            &lt;div class=&quot;col-sm-4&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">                        &lt;img src=&quot;{{ &quot;{{ $pelicula[&#39;poster&#39;]&quot; }}}}&quot; alt=&quot;{{ &quot;{{ $pelicula[&#39;title&#39;]&quot; }}}}&quot;/&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">            &lt;/div&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">            &lt;div class=&quot;col-sm-8&quot;&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">                        &lt;h2&gt;{{ &quot;{{ $pelicula[&#39;title&#39;]&quot; }}}}&lt;/h2&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">                        &lt;h4&gt;{{ &quot;{{ $pelicula[&#39;year&#39;]&quot; }}}}&lt;/h4&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="x">                        &lt;h4&gt;{{ &quot;{{ $pelicula[&#39;director&#39;]&quot; }}}}&lt;/h4&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">                        &lt;p&gt;&lt;strong&gt;Resumen: &lt;/strong&gt;{{ &quot;{{ $pelicula[&#39;synopsis&#39;]&quot; }}}}&lt;/p&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">                        &lt;p&gt;&lt;strong&gt;Estado: &lt;/strong&gt;Pel.lícula @if ($pelicula[&#39;rented&#39;])  Actualment llogada @else disponible @endif&lt;/p&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">                        &lt;p&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">                           @if ($pelicula[&#39;rented&#39;]) </span>
<span class="linenos" data-linenos="15 "></span><span class="x">                            &lt;a href=&#39;&#39; class=&quot;btn btn-info&quot;&gt;Tornar Pel.lícula&lt;/a&gt; </span>
<span class="linenos" data-linenos="16 "></span><span class="x">                           @else </span>
<span class="linenos" data-linenos="17 "></span><span class="x">                            &lt;a href=&#39;&#39; class=&quot;btn btn-danger&quot;&gt;Llogar Pel.lícula&lt;/a&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x">                           @endif </span>
<span class="linenos" data-linenos="19 "></span><span class="x">                           &lt;a href=&quot;{{ &quot;{{ route(&#39;catalog.edit&#39;,$id)&quot; }}}}&quot; class=&quot;btn btn-warning&quot;&gt;&lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt;Editar Pel.lícula&lt;/a&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">                           &lt;a href=&quot;\catalog&quot; class=&quot;btn btn-default&quot;&gt;Tornar catàleg&lt;/a&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">                        &lt;/p&gt;</span>
<span class="linenos" data-linenos="22 "></span><span class="x">            &lt;/div&gt; </span>
<span class="linenos" data-linenos="23 "></span><span class="x">        &lt;/div&gt;</span>
<span class="linenos" data-linenos="24 "></span><span class="x">    @stop</span>
</code></pre></div>
<p><strong>create.blade.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    @extends(&#39;layouts.master&#39;)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    @section(&#39;content&#39;)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">    &lt;div class=&quot;row&quot; style=&quot;margin-top:20px&quot;&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">        &lt;div class=&quot;col-md-offset-3 col-md-6&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">            &lt;div class=&quot;panel panel-default&quot;&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">                &lt;div class=&quot;panel-heading&quot;&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">                    &lt;h3 class=&quot;panel-title text-center&quot;&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">                        &lt;span class=&quot;glyphicon glyphicon-film&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">                        Afegir pel.lícula</span>
<span class="linenos" data-linenos="10 "></span><span class="x">                    &lt;/h3&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">                &lt;/div&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">                &lt;div class=&quot;panel-body&quot; style=&quot;padding:30px&quot;&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">                    &lt;form method=&#39;POST&#39;&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">                        @csrf</span>
<span class="linenos" data-linenos="15 "></span><span class="x">                        &lt;div class=&quot;form-group&quot;&gt;</span>
<span class="linenos" data-linenos="16 "></span><span class="x">                            &lt;label for=&quot;title&quot;&gt;Título&lt;/label&gt;</span>
<span class="linenos" data-linenos="17 "></span><span class="x">                            &lt;input type=&quot;text&quot; name=&quot;title&quot; id=&quot;title&quot; class=&quot;form-control&quot;&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x">                        &lt;/div&gt;</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span><span class="x">                        &lt;div class=&quot;form-group&quot;&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">                            &lt;label for=&#39;year&#39;&gt;Any:&lt;/label&gt;</span>
<span class="linenos" data-linenos="22 "></span><span class="x">                            &lt;input type=&#39;number&#39; name=&#39;year&#39; /&gt;</span>
<span class="linenos" data-linenos="23 "></span><span class="x">                        &lt;/div&gt;</span>
<span class="linenos" data-linenos="24 "></span><span class="x">                        &lt;div class=&quot;form-group&quot;&gt;</span>
<span class="linenos" data-linenos="25 "></span><span class="x">                            &lt;label for=&#39;director&#39;&gt;Director:&lt;/label&gt;</span>
<span class="linenos" data-linenos="26 "></span><span class="x">                            &lt;input type=&#39;text&#39; name=&#39;director&#39; /&gt;</span>
<span class="linenos" data-linenos="27 "></span><span class="x">                        &lt;/div&gt;</span>
<span class="linenos" data-linenos="28 "></span>
<span class="linenos" data-linenos="29 "></span><span class="x">                        &lt;div class=&quot;form-group&quot;&gt;</span>
<span class="linenos" data-linenos="30 "></span><span class="x">                            &lt;label for=&#39;poster&#39;&gt;Poster:&lt;/label&gt;</span>
<span class="linenos" data-linenos="31 "></span><span class="x">                            &lt;input type=&#39;url&#39; name=&#39;poster&#39; /&gt;</span>
<span class="linenos" data-linenos="32 "></span><span class="x">                        &lt;/div&gt;</span>
<span class="linenos" data-linenos="33 "></span>
<span class="linenos" data-linenos="34 "></span><span class="x">                        &lt;div class=&quot;form-group&quot;&gt;</span>
<span class="linenos" data-linenos="35 "></span><span class="x">                            &lt;label for=&quot;synopsis&quot;&gt;Resumen&lt;/label&gt;</span>
<span class="linenos" data-linenos="36 "></span><span class="x">                            &lt;textarea name=&quot;synopsis&quot; id=&quot;synopsis&quot; class=&quot;form-control&quot; rows=&quot;3&quot;&gt;&lt;/textarea&gt;</span>
<span class="linenos" data-linenos="37 "></span><span class="x">                        &lt;/div&gt;</span>
<span class="linenos" data-linenos="38 "></span>
<span class="linenos" data-linenos="39 "></span><span class="x">                        &lt;div class=&quot;form-group text-center&quot;&gt;</span>
<span class="linenos" data-linenos="40 "></span><span class="x">                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot; style=&quot;padding:8px 100px;margin-top:25px;&quot;&gt;</span>
<span class="linenos" data-linenos="41 "></span><span class="x">                                Afegir pel.lícula</span>
<span class="linenos" data-linenos="42 "></span><span class="x">                            &lt;/button&gt;</span>
<span class="linenos" data-linenos="43 "></span><span class="x">                        &lt;/div&gt;</span>
<span class="linenos" data-linenos="44 "></span><span class="x">                    &lt;/form&gt;</span>
<span class="linenos" data-linenos="45 "></span><span class="x">                &lt;/div&gt;</span>
<span class="linenos" data-linenos="46 "></span><span class="x">            &lt;/div&gt;</span>
<span class="linenos" data-linenos="47 "></span><span class="x">        &lt;/div&gt;</span>
<span class="linenos" data-linenos="48 "></span><span class="x">    &lt;/div&gt;</span>
<span class="linenos" data-linenos="49 "></span><span class="x">    @stop</span>
</code></pre></div>
<p><strong>edit.blade.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    @extends(&#39;layouts.master&#39;)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    @section(&#39;content&#39;)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">    &lt;div class=&quot;row&quot; style=&quot;margin-top:20px&quot;&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">        &lt;div class=&quot;col-md-offset-3 col-md-6&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">            &lt;div class=&quot;panel panel-default&quot;&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">                &lt;div class=&quot;panel-heading&quot;&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">                    &lt;h3 class=&quot;panel-title text-center&quot;&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">                        &lt;span class=&quot;glyphicon glyphicon-film&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">                        Modificar pel.lícula</span>
<span class="linenos" data-linenos="10 "></span><span class="x">                    &lt;/h3&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">                &lt;/div&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">                &lt;div class=&quot;panel-body&quot; style=&quot;padding:30px&quot;&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">                    &lt;form method=&#39;POST&#39;&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">                        @csrf</span>
<span class="linenos" data-linenos="15 "></span><span class="x">                        @method(&#39;PUT&#39;)</span>
<span class="linenos" data-linenos="16 "></span><span class="x">                        &lt;div class=&quot;form-group&quot;&gt;</span>
<span class="linenos" data-linenos="17 "></span><span class="x">                            &lt;label for=&quot;title&quot;&gt;Título&lt;/label&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x">                            &lt;input type=&quot;text&quot; name=&quot;title&quot; id=&quot;title&quot; class=&quot;form-control&quot;&gt;</span>
<span class="linenos" data-linenos="19 "></span><span class="x">                        &lt;/div&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">                        &lt;div class=&quot;form-group&quot;&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">                            &lt;label for=&#39;year&#39;&gt;Any:&lt;/label&gt;</span>
<span class="linenos" data-linenos="22 "></span><span class="x">                            &lt;input type=&#39;number&#39; name=&#39;year&#39; /&gt;</span>
<span class="linenos" data-linenos="23 "></span><span class="x">                        &lt;/div&gt;</span>
<span class="linenos" data-linenos="24 "></span><span class="x">                        &lt;div class=&quot;form-group&quot;&gt;</span>
<span class="linenos" data-linenos="25 "></span><span class="x">                            &lt;label for=&#39;director&#39;&gt;Director:&lt;/label&gt;</span>
<span class="linenos" data-linenos="26 "></span><span class="x">                            &lt;input type=&#39;text&#39; name=&#39;director&#39; /&gt;</span>
<span class="linenos" data-linenos="27 "></span><span class="x">                        &lt;/div&gt;</span>
<span class="linenos" data-linenos="28 "></span><span class="x">                        &lt;div class=&quot;form-group&quot;&gt;</span>
<span class="linenos" data-linenos="29 "></span><span class="x">                            &lt;label for=&#39;poster&#39;&gt;Poster:&lt;/label&gt;</span>
<span class="linenos" data-linenos="30 "></span><span class="x">                            &lt;input type=&#39;url&#39; name=&#39;poster&#39; /&gt;</span>
<span class="linenos" data-linenos="31 "></span><span class="x">                        &lt;/div&gt;</span>
<span class="linenos" data-linenos="32 "></span>
<span class="linenos" data-linenos="33 "></span><span class="x">                        &lt;div class=&quot;form-group&quot;&gt;</span>
<span class="linenos" data-linenos="34 "></span><span class="x">                            &lt;label for=&quot;synopsis&quot;&gt;Resumen&lt;/label&gt;</span>
<span class="linenos" data-linenos="35 "></span><span class="x">                            &lt;textarea name=&quot;synopsis&quot; id=&quot;synopsis&quot; class=&quot;form-control&quot; rows=&quot;3&quot;&gt;&lt;/textarea&gt;</span>
<span class="linenos" data-linenos="36 "></span><span class="x">                        &lt;/div&gt;</span>
<span class="linenos" data-linenos="37 "></span><span class="x">                        &lt;div class=&quot;form-group text-center&quot;&gt;</span>
<span class="linenos" data-linenos="38 "></span><span class="x">                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot; style=&quot;padding:8px 100px;margin-top:25px;&quot;&gt;</span>
<span class="linenos" data-linenos="39 "></span><span class="x">                                Modificar pel.lícula</span>
<span class="linenos" data-linenos="40 "></span><span class="x">                            &lt;/button&gt;</span>
<span class="linenos" data-linenos="41 "></span><span class="x">                        &lt;/div&gt;</span>
<span class="linenos" data-linenos="42 "></span><span class="x">                    &lt;/form&gt;</span>
<span class="linenos" data-linenos="43 "></span><span class="x">                &lt;/div&gt;</span>
<span class="linenos" data-linenos="44 "></span><span class="x">            &lt;/div&gt;</span>
<span class="linenos" data-linenos="45 "></span><span class="x">        &lt;/div&gt;</span>
<span class="linenos" data-linenos="46 "></span><span class="x">    &lt;/div&gt;</span>
<span class="linenos" data-linenos="47 "></span><span class="x">    @stop</span>
</code></pre></div>
<h3 id="modificant-les-proves">Modificant les proves<a class="headerlink" href="#modificant-les-proves" title="Permanent link">&para;</a></h3>
<p>Perquè totes seguisquen funcionant.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">class BasicTest extends TestCase</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    {</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">        public function testLoadHomePage(){ </span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">            $this-&gt;get(&#39;/&#39;)-&gt;assertStatus(302);</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">        }</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">        public function testLoadCatalogPage(){ </span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">            $this-&gt;get(&#39;/catalog&#39;)-&gt;assertStatus(200)-&gt;assertSee(&#39;Catàleg&#39;);</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        }</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        public function testLoadCreatePage(){ </span>
<span class="linenos" data-linenos="10 "></span><span class="x">            $this-&gt;get(&#39;/catalog/create&#39;)-&gt;assertStatus(200)-&gt;assertSee(&#39;Afegir pel.lícula&#39;);</span>
<span class="linenos" data-linenos="11 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="12 "></span><span class="x">        public function testLoadEditPage(){ </span>
<span class="linenos" data-linenos="13 "></span><span class="x">            $this-&gt;get(&#39;/catalog/edit/2&#39;)-&gt;assertStatus(200)-&gt;assertSee(&#39;Modificar pel.lícula&#39;);</span>
<span class="linenos" data-linenos="14 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="15 "></span><span class="x">        public function testLoadShowPage(){ </span>
<span class="linenos" data-linenos="16 "></span><span class="x">            $this-&gt;get(&#39;/catalog/show/2&#39;)-&gt;assertStatus(200)-&gt;assertSee(&#39;Editar Pel.lícula&#39;);</span>
<span class="linenos" data-linenos="17 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="18 "></span><span class="x">    }</span>
</code></pre></div>
<h3 id="configuracio-de-la-base-de-dades">Configuració de la base de dades<a class="headerlink" href="#configuracio-de-la-base-de-dades" title="Permanent link">&para;</a></h3>
<p><a href="https://youtu.be/SYAffKndJTI"><img alt="" src="../../img/ull.png" />Video</a></p>
<p>En primer lloc anem a configurar correctament la base de dades. Per a açò hem d'actualitzar els fitxers <strong>config/database.php</strong> i <strong>.env</strong> per a indicar que anem a usar una base de dades tipus MySQL cridada "videoclub" juntament amb el nom d'usuari i contrasenya d'accés (<strong>homestead</strong> i <strong>secret</strong>)</p>
<p>A continuació obrim PHPMyAdmin i creem una nova base de dades anomenada videoclub. Per a comprovar que tot s'ha configurat correctament anem a un terminal en la carpeta del nostre projecte i executem el comando que crea la taula de migracions. </p>
<p>Si tot va bé podrem actualitzar des de PHPMyAdmin i comprovar que s'ha creat aquesta taula dins de la nostra nova base de dades.</p>
<p>Si ens donara algun error haurem de revisar els valors indicats en el fitxer .env. </p>
<p>Ara anem a crear la taula que utilitzarem per a emmagatzemar el catàleg de pel·lícules. Executa el comando de Artisan per a crear la migració anomenada <strong>create_movies_table</strong> per a la taula movies. </p>
<p>Una vegada creat edita aquest fitxer per a afegir tots els camps necessaris, aquests són:</p>
<table>
<thead>
<tr>
<th>Camp</th>
<th>Tipus</th>
<th>Valor per defecte</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>Autoincremental</td>
<td></td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>year</td>
<td>String de longitud 8</td>
<td></td>
</tr>
<tr>
<td>director</td>
<td>String de longitud 64</td>
<td></td>
</tr>
<tr>
<td>poster</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>rented</td>
<td>Booleà</td>
<td>false</td>
</tr>
<tr>
<td>synopsis</td>
<td>Text</td>
<td></td>
</tr>
<tr>
<td>timestamps</td>
<td>Timestamps de Eloquent</td>
<td></td>
</tr>
</tbody>
</table>
<p>Recorda que en el mètode down de la migració has de desfer els canvis que has fet en el mètode up, en aquest cas seria eliminar la taula.</p>
<p>Finalment executarem el comando de Artisan que afig les noves migracions i comprovarem en PHPMyAdmin que la taula s'ha creat correctament amb els camps que li hem indicat.</p>
<p><strong>.env</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">...</span>
<span class="linenos" data-linenos="2 "></span><span class="x">DB_CONNECTION=mysql</span>
<span class="linenos" data-linenos="3 "></span><span class="x">DB_HOST=127.0.0.1</span>
<span class="linenos" data-linenos="4 "></span><span class="x">DB_PORT=3306</span>
<span class="linenos" data-linenos="5 "></span><span class="x">DB_DATABASE=videoclub</span>
<span class="linenos" data-linenos="6 "></span><span class="x">DB_USERNAME=homestead</span>
<span class="linenos" data-linenos="7 "></span><span class="x">DB_PASSWORD=secret</span>
<span class="linenos" data-linenos="8 "></span><span class="x">...</span>
</code></pre></div>
<p><img alt="" src="../../img/ls05.png" /></p>
<p><strong>create_movies_table.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schema</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">class</span> <span class="nc">CreateMoviesTable</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="10 "></span><span class="sd">     * Run the migrations.</span>
<span class="linenos" data-linenos="11 "></span><span class="sd">     *</span>
<span class="linenos" data-linenos="12 "></span><span class="sd">     * @return void</span>
<span class="linenos" data-linenos="13 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;movies&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="17 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="18 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
<span class="linenos" data-linenos="20 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;director&#39;</span><span class="p">,</span><span class="mi">64</span><span class="p">);</span>
<span class="linenos" data-linenos="21 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;poster&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="22 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">boolean</span><span class="p">(</span><span class="s1">&#39;rented&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">default</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
<span class="linenos" data-linenos="23 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">(</span><span class="s1">&#39;synopsis&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="24 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
<span class="linenos" data-linenos="25 "></span>        <span class="p">});</span>
<span class="linenos" data-linenos="26 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="27 "></span>
<span class="linenos" data-linenos="28 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="29 "></span><span class="sd">     * Reverse the migrations.</span>
<span class="linenos" data-linenos="30 "></span><span class="sd">     *</span>
<span class="linenos" data-linenos="31 "></span><span class="sd">     * @return void</span>
<span class="linenos" data-linenos="32 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="33 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
<span class="linenos" data-linenos="34 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="35 "></span>        <span class="nx">Schema</span><span class="o">::</span><span class="na">dropIfExists</span><span class="p">(</span><span class="s1">&#39;movies&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="36 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="37 "></span><span class="p">}</span>
</code></pre></div>
<h3 id="model-de-dades">Model de dades<a class="headerlink" href="#model-de-dades" title="Permanent link">&para;</a></h3>
<p><a href="https://youtu.be/Y0W5GNNQFXU"><img alt="" src="../../img/ull.png" />Video</a></p>
<p>Anem a crear el model de dades associat amb la taula movies. Per a açò usarem el comando apropiat de Artisan per a crear el model anomenat Movie.</p>
<p>Una vegada creat aquest fitxer ho obrirem i comprovarem que el nom de la classe siga el correcte i que herete de la classe Model. 
I ja està, no és necessari fer res més, el cos de la classe pot estar buit ({}), tot la resta es fa automàticament!</p>
<p><img alt="" src="../../img/ls06.png" /></p>
<h3 id="seeders">Seeders<a class="headerlink" href="#seeders" title="Permanent link">&para;</a></h3>
<p>Ara anem a procedir a emplenar la taula de la base de dades amb les dades inicials. Per a açò editem el fitxer de llavors situat en <strong>database/seeds/DatabaseSeeder.php</strong> i seguirem els següents passos:</p>
<ul>
<li>Crear un mètode privat (dins de la mateixa classe) anomenat seedCatalog() que s'haurà de cridar des del mètode run de la forma:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">public function run() {</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    self::seedCatalog();</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    $this-&gt;command-&gt;info(&#39;Taula catàleg inicialitzada amb dades!&#39;); </span>
<span class="linenos" data-linenos="4 "></span><span class="x">}</span>
</code></pre></div>
<ul>
<li>Movem el array de pel·lícules que es facilitava en els materials i que havíem copiat dins del controlador CatalogController a la classe de llavors (DatabaseSeeder.php), guardant-ho de la mateixa forma, com a variable privada de la classe.</li>
<li>Dins del nou mètode seedCatalog() realitzem les següents accions:<ul>
<li>En primer lloc esborrem el contingut de la taula movies amb <strong>DB::table('movies')-&gt;delete();</strong></li>
<li>I a continuació afegim el següent codi:</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">foreach( $this-&gt;arrayPeliculas as $pelicula) { </span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    $p = new Movie;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">    $p-&gt;title = $pelicula[&#39;title&#39;];</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    $p-&gt;year = $pelicula[&#39;year&#39;];</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    $p-&gt;director = $pelicula[&#39;director&#39;]; </span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    $p-&gt;poster = $pelicula[&#39;poster&#39;]; </span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    $p-&gt;rented = $pelicula[&#39;rented&#39;]; </span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    $p-&gt;synopsis = $pelicula[&#39;synopsis&#39;]; </span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">    $p-&gt;save();</span>
<span class="linenos" data-linenos="10 "></span><span class="x">}</span>
</code></pre></div>
<p>Finalment haurem d'executar el comando de Artisan que processa les llavors i una vegada realitzat obrirem
PHPMyAdmin per a comprovar que s'emplenat la taula movies amb el llistat de pel·lícules.</p>
<p>Si t'apareix l'error "<strong>Fatal error: Class 'Movie' not found</strong>" revisa si has indicat l'espai de noms
del model que vas a utilitzar (use App\Movie;).</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">use Illuminate\Database\Seeder;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">use App\Movie;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">class DatabaseSeeder extends Seeder</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">{</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">private $arrayPeliculas = </span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">..</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">public function run()</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        {</span>
<span class="linenos" data-linenos="10 "></span><span class="x">            self::seedCatalog();</span>
<span class="linenos" data-linenos="11 "></span><span class="x">            $this-&gt;command-&gt;info(&#39;Taula catàleg inicialitzada amb dades!&#39;);</span>
<span class="linenos" data-linenos="12 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="x">    private function seedCatalog()</span>
<span class="linenos" data-linenos="16 "></span><span class="x">    {</span>
<span class="linenos" data-linenos="17 "></span><span class="x">        DB::table(&#39;movies&#39;)-&gt;delete();</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span><span class="x">        foreach ($this-&gt;arrayPeliculas as $pelicula) {</span>
<span class="linenos" data-linenos="20 "></span><span class="x">            $p = new Movie;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">            $p-&gt;title = $pelicula[&#39;title&#39;];</span>
<span class="linenos" data-linenos="22 "></span><span class="x">            $p-&gt;year = $pelicula[&#39;year&#39;];</span>
<span class="linenos" data-linenos="23 "></span><span class="x">            $p-&gt;director = $pelicula[&#39;director&#39;];</span>
<span class="linenos" data-linenos="24 "></span><span class="x">            $p-&gt;poster = $pelicula[&#39;poster&#39;];</span>
<span class="linenos" data-linenos="25 "></span><span class="x">            $p-&gt;rented = $pelicula[&#39;rented&#39;];</span>
<span class="linenos" data-linenos="26 "></span><span class="x">            $p-&gt;synopsis = $pelicula[&#39;synopsis&#39;];</span>
<span class="linenos" data-linenos="27 "></span><span class="x">            $p-&gt;save();</span>
<span class="linenos" data-linenos="28 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="29 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="30 "></span><span class="x">}    </span>
</code></pre></div>
<p><img alt="" src="../../img/ls07.png" /></p>
<h3 id="us-de-la-base-de-dades">Ús de la base de dades<a class="headerlink" href="#us-de-la-base-de-dades" title="Permanent link">&para;</a></h3>
<p>Anem a actualitzar els mètodes del controlador CatalogController perquè obtinguen les dades des de la base de dades. Seguirem els següents passos:</p>
<ul>
<li>Modificar el mètode index perquè obtinga tota la llista de pel·lícules des de la base de dades usant el model Movie i que li la passe a la vista.</li>
<li>Modificar el mètode show perquè obtinga la pel·lícula passada per paràmetre usant el mètode findOrFail i li la passe a la vista.</li>
<li>Modificar el mètode edit perquè obtinga la pel·lícula passada per paràmetre usant el mètode findOrFail i li la passe a la vista.</li>
</ul>
<p>Si en provar-ho t'apareix l'error "<strong>Class 'Videoclub\Http\Controllers\Movie' not found</strong>" revisa si has indicat l'espai de noms del model que vas a utilitzar (use Videoclub\Movie;).</p>
<p>Ja no necessitarem més el array de pel·lícules (\$arrayPeliculas) que havíem posat en el controlador, així que ho podem comentar o eliminar.</p>
<p>Ara haurem d'actualitzar les vistes perquè en lloc d'accedir a les dades del array els obtinga de l'objecte amb la pel·lícula. Per a açò canviarem en tots els llocs on hàgem posat \$pelicula['camp'] per \$pelicula-&gt;camp.</p>
<p>A més, en la vista catalog/index.blade.php, en comptes d'utilitzar l'índex del array (\$key) com a identificador per a crear l'enllaç a catalog/show/{id}, haurem d'utilitzar el camp id de la pel·lícula (\$pelicula-&gt;id). 
El mateix en la vista catalog/show.blade.php, per a generar l'enllaç d'editar pel·lícula haurem d'afegir l'identificador de la pel·lícula a la ruta catalog/edit.</p>
<p><strong>catalogController.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    use Illuminate\Http\Request;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    use App\Movie;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">    class CatalogController extends Controller</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">    {</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">        public function getIndex(){</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">            $arrayPeliculas = Movie::all();</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">            return view(&#39;index&#39;,compact(&#39;arrayPeliculas&#39;));</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="10 "></span><span class="x">        public function getShow($id){</span>
<span class="linenos" data-linenos="11 "></span><span class="x">            $pelicula = Movie::findOrFail($id);</span>
<span class="linenos" data-linenos="12 "></span><span class="x">            return view(&#39;show&#39;,compact(&#39;pelicula&#39;));</span>
<span class="linenos" data-linenos="13 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="14 "></span><span class="x">        public function getCreate(){</span>
<span class="linenos" data-linenos="15 "></span><span class="x">            return view(&#39;create&#39;);</span>
<span class="linenos" data-linenos="16 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="17 "></span><span class="x">        public function getEdit($id){</span>
<span class="linenos" data-linenos="18 "></span><span class="x">            $pelicula = Movie::findOrFail($id);</span>
<span class="linenos" data-linenos="19 "></span><span class="x">            return view(&#39;edit&#39;,compact(&#39;pelicula&#39;));</span>
<span class="linenos" data-linenos="20 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="21 "></span><span class="x">    }</span>
</code></pre></div>
<p><strong>index.blade.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>    @extends(&#39;layouts.master&#39;)
<span class="linenos" data-linenos=" 2 "></span>    @section(&#39;content&#39;)
<span class="linenos" data-linenos=" 3 "></span>    &lt;h2 &gt;Catàleg&lt;/h2&gt;
<span class="linenos" data-linenos=" 4 "></span>        &lt;div class=&quot;row&quot;&gt;
<span class="linenos" data-linenos=" 5 "></span>        @foreach( $arrayPeliculas as $pelicula )        
<span class="linenos" data-linenos=" 6 "></span>            &lt;div class=&quot;col-xs-6 col-sm-4 col-md-3 text-center&quot;&gt;
<span class="linenos" data-linenos=" 7 "></span>                &lt;a href=&quot;{{ &quot;{{ url(&#39;/catalog/show/&#39;.$pelicula-&gt;id) &quot; }}}}&quot;&gt;
<span class="linenos" data-linenos=" 8 "></span>                    &lt;img src=&quot;{{ &quot;{{$pelicula[&#39;poster&#39;]&quot; }}}}&quot; style=&quot;height:200px&quot;/&gt; 
<span class="linenos" data-linenos=" 9 "></span>                    &lt;h4 style=&quot;min-height:45px;margin:5px 0 10px 0&quot;&gt;
<span class="linenos" data-linenos="10 "></span>                    {{ &quot;{{$pelicula-&gt;title&quot; }}}} &lt;/h4&gt;
<span class="linenos" data-linenos="11 "></span>                &lt;/a&gt;
<span class="linenos" data-linenos="12 "></span>            &lt;/div&gt; 
<span class="linenos" data-linenos="13 "></span>        @endforeach
<span class="linenos" data-linenos="14 "></span>        &lt;/div&gt;  
<span class="linenos" data-linenos="15 "></span>    @stop
</code></pre></div>
<p><strong>show.blade.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    @extends(&#39;layouts.master&#39;)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    @section(&#39;content&#39;)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">        &lt;div class=&quot;row&quot;&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">            &lt;div class=&quot;col-sm-4&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">                        &lt;img src=&quot;{{ &quot;{{$pelicula-&gt;poster&quot; }}}}&quot; alt=&quot;{{ &quot;{{$pelicula-&gt;title&quot; }}}}&quot;/&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">            &lt;/div&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">            &lt;div class=&quot;col-sm-8&quot;&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">                        &lt;h2&gt;{{ &quot;{{$pelicula-&gt;title&quot; }}}}&lt;/h2&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">                        &lt;h4&gt;{{ &quot;{{$pelicula-&gt;year&quot; }}}}&lt;/h4&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="x">                        &lt;h4&gt;{{ &quot;{{$pelicula-&gt;director&quot; }}}}&lt;/h4&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">                        &lt;p&gt;&lt;strong&gt;Resumen: &lt;/strong&gt;{{ &quot;{{$pelicula-&gt;synopsis&quot; }}}}&lt;/p&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">                        &lt;p&gt;&lt;strong&gt;Estado: &lt;/strong&gt;Pel.lícula @if ($pelicula-&gt;rented)  Actualment llogada @else disponible @endif&lt;/p&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">                        &lt;p&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">                           @if ($pelicula-&gt;rented) </span>
<span class="linenos" data-linenos="15 "></span><span class="x">                            &lt;a href=&#39;&#39; class=&quot;btn btn-info&quot;&gt;Tornar Pel.lícula&lt;/a&gt; </span>
<span class="linenos" data-linenos="16 "></span><span class="x">                           @else </span>
<span class="linenos" data-linenos="17 "></span><span class="x">                            &lt;a href=&#39;&#39; class=&quot;btn btn-danger&quot;&gt;Llogar Pel.lícula&lt;/a&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x">                           @endif </span>
<span class="linenos" data-linenos="19 "></span><span class="x">                           &lt;a href=&quot;\catalog\edit\{{ &quot;{{$pelicula-&gt;id&quot; }}}}&quot; class=&quot;btn btn-warning&quot;&gt;&lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt;Editar Pel.lícula&lt;/a&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">                           &lt;a href=&quot;\catalog&quot; class=&quot;btn btn-default&quot;&gt;Tornar catàleg&lt;/a&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">                        &lt;/p&gt;</span>
<span class="linenos" data-linenos="22 "></span><span class="x">            &lt;/div&gt; </span>
<span class="linenos" data-linenos="23 "></span><span class="x">        &lt;/div&gt;</span>
<span class="linenos" data-linenos="24 "></span><span class="x">    @stop</span>
</code></pre></div>
<h3 id="afegir-i-editar-pellicules">Afegir i editar pel·lícules<a class="headerlink" href="#afegir-i-editar-pellicules" title="Permanent link">&para;</a></h3>
<p><a href="https://youtu.be/eg47wpRMNxw"><img alt="" src="../../img/ull.png" />Video</a></p>
<p>En primer lloc anem a afegir les rutes que ens van a fer falta per a arreplegar les dades en enviar els formularis. Per a açò editem el fitxer de rutes i afegim dues rutes (també protegides pel filtre auth):</p>
<ul>
<li>Una ruta de tipus POST per a la url catalog/create que apuntarà al mètode postCreate del controlador CatalogController.</li>
<li>I una altra ruta tipus PUT per a la url catalog/edit/{id} que apuntarà al mètode putEdit del controlador CatalogController.</li>
</ul>
<p>A continuació anem a editar la vista catalog/edit.blade.php amb els següents canvis:</p>
<ul>
<li>Revisar que el mètode d'enviament del formulari siga tipus PUT.</li>
<li>Hem de modificar tots els inputs perquè com a valor del camp pose el valor corresponent de la pel·lícula. Per exemple en el primer input hauríem d'afegir value="{{$pelicula-&gt;title}}". </li>
<li>Realitza el mateix per a la resta de camps: year, director, poster i synopsis. L'únic camp diferent serà el de synopsis ja que el input és tipus textarea, en aquest cas el valor ho haurem de posar directament entre l'etiqueta d'obertura i la de tancament.</li>
<li>
<p>Finalment hem d'actualitzar el controlador CatalogController amb els dos nous mètodes. En tots dos casos hem d'usar la injecció de dependències per a afegir la classe Request com a paràmetre d'entrada (revisa la secció "Dades d'entrada" de la teoria). A més per a cada mètode farem:</p>
</li>
<li>
<p>En el mètode postCreate vam crear una nova instància del model Movie, assignem el valor de tots els camps d'entrada (title, year, director, poster i synopsis) i els guardem. Finalment, després de guardar, fem una redirecció a la ruta /catalog.</p>
</li>
<li>En el mètode putEdit cerquem la pel·lícula amb l'identificador passat per paràmetre, actualitzem els seus camps i els guardem. Finalment realitzem una redirecció a la pantalla amb la vista detalle de la pel·lícula editada.
Nota: de moment en cas d'error no es mostrarà res.</li>
</ul>
<p>** web.php **</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    Auth::routes();</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    Route::get(&#39;/&#39;,&#39;HomeController@getHome&#39;);</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">    Route::group([&#39;middleware&#39;=&gt;&#39;auth&#39;],function(){</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">        Route::get(&#39;/logout&#39;,&#39;Auth\Logincontroller@logout&#39;);</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">        Route::get(&#39;catalog&#39;,&#39;CatalogController@getIndex&#39;);</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">        Route::get(&#39;catalog/show/{id}&#39;, &#39;CatalogController@getShow&#39;);</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">        Route::get(&#39;catalog/create&#39;,&#39;CatalogController@getCreate&#39;);</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        Route::post(&#39;catalog/create&#39;,&#39;CatalogController@postCreate&#39;);</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        Route::get(&#39;catalog/edit/{id}&#39;,&#39;CatalogController@getEdit&#39;);</span>
<span class="linenos" data-linenos="10 "></span><span class="x">        Route::put(&#39;catalog/edit/{id}&#39;,&#39;CatalogController@putEdit&#39;);</span>
<span class="linenos" data-linenos="11 "></span><span class="x">    });</span>
</code></pre></div>
<p><img alt="" src="../../img/ls09.png" /></p>
<p>** HomeController **</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Auth</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">class</span> <span class="nc">HomeController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getHome</span><span class="p">()</span>
<span class="linenos" data-linenos="12 "></span>        <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>            <span class="k">if</span> <span class="p">(</span><span class="nx">Auth</span><span class="o">::</span><span class="na">user</span><span class="p">())</span>
<span class="linenos" data-linenos="14 "></span>                <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">action</span><span class="p">(</span><span class="s1">&#39;CatalogController@getIndex&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="15 "></span>            <span class="k">else</span> 
<span class="linenos" data-linenos="16 "></span>                <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="17 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="18 "></span>    <span class="p">}</span>
</code></pre></div>
<p>** CatalogController **</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">use</span> <span class="nx">App\Movie</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">class</span> <span class="nc">CatalogController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getIndex</span><span class="p">(){</span>
<span class="linenos" data-linenos="11 "></span>            <span class="nv">$arrayPeliculas</span> <span class="o">=</span> <span class="nx">Movie</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>
<span class="linenos" data-linenos="12 "></span>            <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span><span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;arrayPeliculas&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos="13 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="14 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getShow</span><span class="p">(</span><span class="nv">$id</span><span class="p">){</span>
<span class="linenos" data-linenos="15 "></span>            <span class="nv">$pelicula</span> <span class="o">=</span> <span class="nx">Movie</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos="16 "></span>            <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">,</span><span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;pelicula&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos="17 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="18 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getCreate</span><span class="p">(){</span>
<span class="linenos" data-linenos="19 "></span>            <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="20 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="21 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">postCreate</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">){</span>
<span class="linenos" data-linenos="22 "></span>            <span class="nv">$movie</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Movie</span><span class="p">();</span>
<span class="linenos" data-linenos="23 "></span>            <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">;</span>
<span class="linenos" data-linenos="24 "></span>            <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">year</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">year</span><span class="p">;</span>
<span class="linenos" data-linenos="25 "></span>            <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">director</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">director</span><span class="p">;</span>
<span class="linenos" data-linenos="26 "></span>            <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">poster</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">poster</span><span class="p">;</span>
<span class="linenos" data-linenos="27 "></span>            <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">synopsis</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">synopsis</span><span class="p">;</span>
<span class="linenos" data-linenos="28 "></span>            <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="linenos" data-linenos="29 "></span>            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/catalog&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="30 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="31 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getEdit</span><span class="p">(</span><span class="nv">$id</span><span class="p">){</span>
<span class="linenos" data-linenos="32 "></span>            <span class="nv">$pelicula</span> <span class="o">=</span> <span class="nx">Movie</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos="33 "></span>            <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;edit&#39;</span><span class="p">,</span><span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;pelicula&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos="34 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="35 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">putEdit</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span><span class="nv">$id</span><span class="p">){</span>
<span class="linenos" data-linenos="36 "></span>            <span class="nv">$movie</span> <span class="o">=</span> <span class="nx">Movie</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos="37 "></span>            <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">;</span>
<span class="linenos" data-linenos="38 "></span>            <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">year</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">year</span><span class="p">;</span>
<span class="linenos" data-linenos="39 "></span>            <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">director</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">director</span><span class="p">;</span>
<span class="linenos" data-linenos="40 "></span>            <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">poster</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">poster</span><span class="p">;</span>
<span class="linenos" data-linenos="41 "></span>            <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">synopsis</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">synopsis</span><span class="p">;</span>
<span class="linenos" data-linenos="42 "></span>            <span class="nv">$movie</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="linenos" data-linenos="43 "></span>            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s2">&quot;/catalog/show/</span><span class="si">$id</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="44 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="45 "></span>    <span class="p">}</span>
</code></pre></div>
<h3 id="validacio-formulari">Validació Formulari<a class="headerlink" href="#validacio-formulari" title="Permanent link">&para;</a></h3>
<p><a href="https://youtu.be/iojmY5DbpXU"><img alt="" src="../../img/ull.png" />Video</a></p>
<h3 id="proves">Proves<a class="headerlink" href="#proves" title="Permanent link">&para;</a></h3>
<p>Ara fallen totes les proves en les quals hem d'estar autenticats. Per a corregir açò hem d'executar el get una vegada que ens hàgem loguejat. Per a fer açò tenim actuar com un usuari.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>private function defaultUser(){ 
<span class="linenos" data-linenos="2 "></span>    return User::find(1);
<span class="linenos" data-linenos="3 "></span>}
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span>public function testLoadCreatePage(){ 
<span class="linenos" data-linenos="6 "></span>   $this-&gt;actingAs($this-&gt;defaultUser())-&gt;get(&#39;/catalog/create&#39;)-&gt;assertStatus(200)-&gt;assertSee(&#39;Afegir pel.lícula&#39;);
<span class="linenos" data-linenos="7 "></span>}
</code></pre></div>
<p>Fes que totes les proves tornen a funcionar.</p>
<h2 id="installacio-de-paquets">Instal.lació de paquets<a class="headerlink" href="#installacio-de-paquets" title="Permanent link">&para;</a></h2>
<p><a href="https://youtu.be/IND2inVKTEE"><img alt="" src="../../img/ull.png" />Video</a></p>
<p>Els paquets són la manera primària d'afegir funcionalitat a Laravel. Els paquets podrien ser qualsevol cosa d'una manera: des de un gran de treballar amb dates com <strong>Carbon</strong>, o un marc de testatge de BDD sencer com <strong>Behat</strong>.</p>
<p>Naturalment, hi ha tipus diferents de paquets. Alguns paquets són independent del framework, treballen amb qualsevol marc de PHP. Qualssevol d'aquests paquets poden ser utilitzats amb Laravel afegint-los dins el vostre arxiu composer.json o amb <strong>composer require</strong></p>
<p>D'altra banda, altres paquets són per ús amb Laravel. Aquests paquets poden tenir rutes, controladors, vistes, i la configuració concretament per a Laravel. </p>
<h4 id="exemple-stydenet-html-package">Exemple: StydeNet Html package<a class="headerlink" href="#exemple-stydenet-html-package" title="Permanent link">&para;</a></h4>
<p>Aquest <a href="https://github.com/StydeNet/html">paquet</a> conté una col·lecció de classes de PHP per generar components d'HTML comú, com:</p>
<ul>
<li>Menus</li>
<li>Missatges d'Alerta</li>
<li>Col.leccions en formularis</li>
<li>Camps de ràdios i checkboxes en formulari</li>
</ul>
<p>És una extensió del paquet <a href="https://laravelcollective.com/docs/master/html"><strong>HTML de Laravel Colective</strong></a> i serà molt útil per generar formularis i HTML dinàmicament.</p>
<ul>
<li>
<p>Per <strong>Instal·lar</strong> fes córrer el <strong>composer require "styde/html=~1.8"</strong> o afegint <strong>"styde/html": "~1.8"</strong> a l'arxiu composer.json.</p>
</li>
<li>
<p>També, necessites registrar en el <strong>app/Http/Kernel.php</strong> el middleware \Styde\Html\Alerta\Middleware::class despres del middleware <strong>StartSession</strong> . </p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>// Per Laravel superior a 5.4
<span class="linenos" data-linenos="2 "></span>protected $middlewareGroups = [
<span class="linenos" data-linenos="3 "></span>    \Styde\Html\Alert\Middleware::class,
<span class="linenos" data-linenos="4 "></span>    //...
<span class="linenos" data-linenos="5 "></span>];
</code></pre></div>
</li>
</ul>
<p>Aquest middleware és necessitat per fer els missatges d'alerta persistents entre sessions, després de que cada petició és completada.</p>
<p>Ara tindràs automàticament disponibles el següents components:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>Alert =&gt; Styde\Html\Facades\Alert
<span class="linenos" data-linenos="2 "></span>Field =&gt; Styde\Html\Facades\Field
<span class="linenos" data-linenos="3 "></span>Menu  =&gt; Styde\Html\Facades\Menu
<span class="linenos" data-linenos="4 "></span>Form  =&gt; Collective\Html\FormFacade
<span class="linenos" data-linenos="5 "></span>Html  =&gt; Collective\Html\HtmlFacade
</code></pre></div>
<p>Opcionalment, pots també executar <strong>php artisan vendor:publish --provider='Styde\Html\HtmlServiceProvider'</strong> per publicar l'arxiu de configuració en <strong>config/html.php</strong> i revisar les seves opcions i valors.</p>
<h3 id="installa-el-component-styde">Instal.la el component styde<a class="headerlink" href="#installa-el-component-styde" title="Permanent link">&para;</a></h3>
<p>Ja està explicat dalt.</p>
<h3 id="refactorizar-el-formulari">Refactorizar el formulari<a class="headerlink" href="#refactorizar-el-formulari" title="Permanent link">&para;</a></h3>
<p>En primer lloc, anem a canviar el formulari 'create'. Substituïm tot el codi html per este que utilitza la classe Form dels components instal.lats. El formulari està associat està associat a un model i posse els camps que en fan falta. No cal possar el @csfr doncs es possa automàticament.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    * {!! Form::model(new App\Movie(),[&#39;class&#39;=&gt;&#39;form-horizontal form-label-left&#39;,&#39;enctype&#39;=&gt;&quot;multipart/form-data&quot;]) !!}</span>
<span class="linenos" data-linenos="2 "></span><span class="x">        {!! Field::text(&#39;title&#39;) !!}</span>
<span class="linenos" data-linenos="3 "></span><span class="x">        {!! Field::text(&#39;year&#39;) !!}</span>
<span class="linenos" data-linenos="4 "></span><span class="x">        {!! Field::text(&#39;director&#39;) !!}</span>
<span class="linenos" data-linenos="5 "></span><span class="x">        {!! Field::text(&#39;poster&#39;) !!}</span>
<span class="linenos" data-linenos="6 "></span><span class="x">        {!! Field::textarea(&#39;synopsis&#39;) !!}</span>
<span class="linenos" data-linenos="7 "></span><span class="x">        {!! Form::submit(&#39;Enviar&#39;,[&#39;class&#39;=&gt;&#39;btn btn-success&#39;,&#39;id&#39;=&gt;&#39;submit&#39;]) !!}</span>
<span class="linenos" data-linenos="8 "></span><span class="x">    {!! Form::close() !!}   *</span>
</code></pre></div>
<p>Canviarem, de la mateixa forma, el formulari de modificació, tenint en compte que si en conte de passar-li el model li passe un element del model, el valors s'afegisen al formulari.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    {!! Form::model($pelicula,[&#39;class&#39;=&gt;&#39;form-horizontal form-label-left&#39;,&#39;enctype&#39;=&gt;&quot;multipart/form-data&quot;,&#39;method&#39;=&gt;&#39;PUT&#39;]) !!}</span>
<span class="linenos" data-linenos="2 "></span><span class="x">        {!! Field::text(&#39;title&#39;) !!}</span>
<span class="linenos" data-linenos="3 "></span><span class="x">        {!! Field::text(&#39;year&#39;) !!}</span>
<span class="linenos" data-linenos="4 "></span><span class="x">        {!! Field::text(&#39;director&#39;) !!}</span>
<span class="linenos" data-linenos="5 "></span><span class="x">        {!! Field::select(&#39;id_genre&#39;) !!}</span>
<span class="linenos" data-linenos="6 "></span><span class="x">        {!! Field::text(&#39;poster&#39;) !!}</span>
<span class="linenos" data-linenos="7 "></span><span class="x">        {!! Field::textarea(&#39;synopsis&#39;) !!}</span>
<span class="linenos" data-linenos="8 "></span><span class="x">    {!! Form::submit(&#39;Enviar&#39;,[&#39;class&#39;=&gt;&#39;btn btn-success&#39;,&#39;id&#39;=&gt;&#39;submit&#39;]) !!}</span>
<span class="linenos" data-linenos="9 "></span><span class="x">    {!! Form::close() !!}</span>
</code></pre></div>
<h3 id="refactoritzar-els-metodes-create-i-update">Refactoritzar els mètodes create i update<a class="headerlink" href="#refactoritzar-els-metodes-create-i-update" title="Permanent link">&para;</a></h3>
<p>Anem a utilitzar l'assignament massiu per a omplir tots els camp a l'hora. Pots fer-ho declarant en el model la variable <strong>$fillable</strong> o la variable <strong>$guard</strong></p>
<p>Després hauràs de substituir l'assignació de tots els camps, en el metodes create i update, per l'instrucció:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>$movie-&gt;fill($request-&gt;toArray());
</code></pre></div>
<p>storeMovie.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\FormRequest</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">use</span> <span class="nx">DateTime</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">class</span> <span class="nc">StoreMovie</span> <span class="k">extends</span> <span class="nx">FormRequest</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="10 "></span>        <span class="sd">/**</span>
<span class="linenos" data-linenos="11 "></span><span class="sd">         * Determine if the user is authorized to make this request.</span>
<span class="linenos" data-linenos="12 "></span><span class="sd">         *</span>
<span class="linenos" data-linenos="13 "></span><span class="sd">         * @return bool</span>
<span class="linenos" data-linenos="14 "></span><span class="sd">         */</span>
<span class="linenos" data-linenos="15 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">authorize</span><span class="p">()</span>
<span class="linenos" data-linenos="16 "></span>        <span class="p">{</span>
<span class="linenos" data-linenos="17 "></span>            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="linenos" data-linenos="18 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span>        <span class="sd">/**</span>
<span class="linenos" data-linenos="21 "></span><span class="sd">         * Get the validation rules that apply to the request.</span>
<span class="linenos" data-linenos="22 "></span><span class="sd">         *</span>
<span class="linenos" data-linenos="23 "></span><span class="sd">         * @return array</span>
<span class="linenos" data-linenos="24 "></span><span class="sd">         */</span>
<span class="linenos" data-linenos="25 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
<span class="linenos" data-linenos="26 "></span>        <span class="p">{</span>
<span class="linenos" data-linenos="27 "></span>            <span class="nv">$now</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">;</span>
<span class="linenos" data-linenos="28 "></span>            <span class="nv">$year</span> <span class="o">=</span> <span class="nv">$now</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="29 "></span>            <span class="k">return</span> <span class="p">[</span>
<span class="linenos" data-linenos="30 "></span>                <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|max:255&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="31 "></span>                <span class="s1">&#39;year&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;required|numeric|min:1900|max:</span><span class="si">$year</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="32 "></span>                <span class="s1">&#39;poster&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span>
<span class="linenos" data-linenos="33 "></span>            <span class="p">];</span>
<span class="linenos" data-linenos="34 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="35 "></span>    <span class="p">}</span>
</code></pre></div>
<p>catalogController.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    ...</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    public function postCreate(StoreMovie $request){</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">        $movie = new Movie();</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">        $movie-&gt;fill($request-&gt;toArray());</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">        $movie-&gt;save();</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">        return redirect(&#39;/catalog&#39;);</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    }</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">    public function putEdit(StoreMovie $request,$id){</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        $movie = Movie::findOrFail($id);</span>
<span class="linenos" data-linenos="10 "></span><span class="x">        $movie-&gt;fill($request-&gt;toArray());</span>
<span class="linenos" data-linenos="11 "></span><span class="x">        $movie-&gt;save();</span>
<span class="linenos" data-linenos="12 "></span><span class="x">        return redirect(&quot;/catalog/show/$id&quot;);</span>
<span class="linenos" data-linenos="13 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="14 "></span><span class="x">    ... </span>
</code></pre></div>
<p>movie.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">protected $guarded = [];</span>
</code></pre></div>
<h3 id="afegir-relacio-u-a-molts">Afegir relació u a molts.<a class="headerlink" href="#afegir-relacio-u-a-molts" title="Permanent link">&para;</a></h3>
<p><a href="https://youtu.be/4Jm81EV0F0Q"><img alt="" src="../../img/ull.png" />Video</a></p>
<ul>
<li>Crea un taula, mitjançant una migració(create_genres_table) que es diga genres (generè en anglés) ('id','titulo') </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schema</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">class</span> <span class="nc">CreateGenresTable</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="10 "></span><span class="sd">     * Run the migrations.</span>
<span class="linenos" data-linenos="11 "></span><span class="sd">     *</span>
<span class="linenos" data-linenos="12 "></span><span class="sd">     * @return void</span>
<span class="linenos" data-linenos="13 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;genres&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="17 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="18 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span>        <span class="p">});</span>
<span class="linenos" data-linenos="20 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="23 "></span><span class="sd">     * Reverse the migrations.</span>
<span class="linenos" data-linenos="24 "></span><span class="sd">     *</span>
<span class="linenos" data-linenos="25 "></span><span class="sd">     * @return void</span>
<span class="linenos" data-linenos="26 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="27 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
<span class="linenos" data-linenos="28 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="29 "></span>        <span class="nx">Schema</span><span class="o">::</span><span class="na">dropIfExists</span><span class="p">(</span><span class="s1">&#39;genres&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="30 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="31 "></span><span class="p">}</span>
</code></pre></div>
<ul>
<li>
<p>Anem a crear una migració alter_movies_table per afegir un camp (id_genre) i crear la clau forània amb genres.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>&lt;?php
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>use Illuminate\Support\Facades\Schema;
<span class="linenos" data-linenos=" 4 "></span>use Illuminate\Database\Schema\Blueprint;
<span class="linenos" data-linenos=" 5 "></span>use Illuminate\Database\Migrations\Migration;
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span>class AlterMoviesTable extends Migration
<span class="linenos" data-linenos=" 8 "></span>{
<span class="linenos" data-linenos=" 9 "></span>    /**
<span class="linenos" data-linenos="10 "></span>     * Run the migrations.
<span class="linenos" data-linenos="11 "></span>     *
<span class="linenos" data-linenos="12 "></span>     * @return void
<span class="linenos" data-linenos="13 "></span>     */
<span class="linenos" data-linenos="14 "></span>    public function up()
<span class="linenos" data-linenos="15 "></span>    {
<span class="linenos" data-linenos="16 "></span>        Schema::table(&#39;movies&#39;, function (Blueprint $table) {
<span class="linenos" data-linenos="17 "></span>            $table-&gt;integer(&#39;id_genre&#39;)-&gt;unsigned()-&gt;nullable();
<span class="linenos" data-linenos="18 "></span>            $table-&gt;foreign(&#39;id_genre&#39;)-&gt;references(&#39;id&#39;)-&gt;on(&#39;genres&#39;)-&gt;onUpdate(&#39;CASCADE&#39;)-&gt;onDelete(&#39;SET NULL&#39;);
<span class="linenos" data-linenos="19 "></span>    });
<span class="linenos" data-linenos="20 "></span>    }
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span>    /**
<span class="linenos" data-linenos="23 "></span>     * Reverse the migrations.
<span class="linenos" data-linenos="24 "></span>     *
<span class="linenos" data-linenos="25 "></span>     * @return void
<span class="linenos" data-linenos="26 "></span>     */
<span class="linenos" data-linenos="27 "></span>    public function down()
<span class="linenos" data-linenos="28 "></span>    {
<span class="linenos" data-linenos="29 "></span>        Schema::table(&#39;movies&#39;, function (Blueprint $table) {
<span class="linenos" data-linenos="30 "></span>            $table-&gt;dropForeign(&#39;movies_id_genre_foreign&#39;);
<span class="linenos" data-linenos="31 "></span>            $table-&gt;dropColumn(&#39;id_genre&#39;);
<span class="linenos" data-linenos="32 "></span>        });
<span class="linenos" data-linenos="33 "></span>    }
</code></pre></div>
<p>}</p>
</li>
<li>
<p>Executa la migració i comprova que tot s'ha executat correctament.</p>
</li>
<li>Emplena la taula Genres amb uns quants.</li>
<li>Afegix el model Genre.</li>
<li>
<p>Afegix la rel.lació belongsTo al model Movie per vincular-la al model Genre.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>public function Genre(){
<span class="linenos" data-linenos="2 "></span>        return $this-&gt;belongsTo(Genre::class,&#39;id_genre&#39;);
<span class="linenos" data-linenos="3 "></span>    }
</code></pre></div>
</li>
<li>
<p>Afegix la rel.lació HasMany al model Genre.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">public function movies(){</span>
<span class="linenos" data-linenos="2 "></span><span class="x">        return $this-&gt;belongsToMany(Movie::class);</span>
<span class="linenos" data-linenos="3 "></span><span class="x">}</span>
</code></pre></div>
<ul>
<li>Per tal que en la vista es motre el titol del gènere:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">        &lt;p&gt;&lt;strong&gt;Genere:&lt;/strong&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">         @if ($pelicula-&gt;Genre)  {{ $pelicula-&gt;Genre-&gt;title @if ($pelicula-&gt;rented)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">                    &lt;form action= {{action(&#39;catalogController@putReturn&#39;,$pelicula-&gt;id)}} method=&quot;POST&quot; style=&quot;display:inline&quot;&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">                        {{ method_field(&#39;PUT&#39;) }}</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">                        @csrf</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">                        &lt;button type=&quot;submit&quot; class=&quot;btn btn-info&quot; &gt; Tornar Película&lt;/button&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">                    &lt;/form&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">                @else</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">                    &lt;form action= {{action(&#39;catalogController@putRent&#39;,$pelicula-&gt;id)}} method=&quot;POST&quot; style=&quot;display:inline&quot;&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="x">                        {{ method_field(&#39;PUT&#39;) }}</span>
<span class="linenos" data-linenos="11 "></span><span class="x">                        @csrf</span>
<span class="linenos" data-linenos="12 "></span><span class="x">                        &lt;button type=&quot;submit&quot; class=&quot;btn btn-secondary&quot; &gt; Llogar Película&lt;/button&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">                    &lt;/form&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">                    &lt;form action= {{action(&#39;catalogController@deleteMovie&#39;,$pelicula-&gt;id)}} method=&quot;POST&quot; style=&quot;display:inline&quot;&gt;</span>
<span class="linenos" data-linenos="15 "></span><span class="x">                        {{ method_field(&#39;DELETE&#39;) }}</span>
<span class="linenos" data-linenos="16 "></span><span class="x">                        @csrf</span>
<span class="linenos" data-linenos="17 "></span><span class="x">                        &lt;button type=&quot;submit&quot; class=&quot;btn btn-danger&quot;  &gt; Esborrar Película&lt;/button&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x">                    &lt;/form&gt;</span>
<span class="linenos" data-linenos="19 "></span><span class="x">                @endif}} </span>
<span class="linenos" data-linenos="20 "></span><span class="x">         @else Desconocido</span>
<span class="linenos" data-linenos="21 "></span><span class="x">         @endif</span>
<span class="linenos" data-linenos="22 "></span><span class="x">        &lt;/p&gt;</span>
</code></pre></div>
<h3 id="afegir-el-camp-genere-al-formulari">Afegir el camp Gènere al formulari.<a class="headerlink" href="#afegir-el-camp-genere-al-formulari" title="Permanent link">&para;</a></h3>
<p><a href="https://youtu.be/Tn3gV_kHD-g"><img alt="" src="../../img/ull.png" />Video</a></p>
<p>Anem a utilitza el component d'Styde:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>{!! Field::select(&#39;id_genre&#39;) !!}
</code></pre></div>
<p>que posarem a les vistes. Si a este component li passem un array de paràmetres, es possarà com a valors seleccionables:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>{!! Field::select(&#39;id_genre&#39;,[&#39;terror&#39;,&#39;musical&#39;,&#39;thriller&#39;]) !!}
</code></pre></div>
<p>També es pot declarar una funció en el model Movie per a que torne els valors.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    public function getIdGenreOptions(){</span>
<span class="linenos" data-linenos="2 "></span><span class="x">        return [&#39;terror&#39;,&#39;musical&#39;,&#39;thriller&#39;]</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    }</span>
</code></pre></div>
<p>Però el que volem és que els valor s'agafem de la <strong>taula Genres</strong>. Tal i com així:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">public function getIdGenreOptions()</span>
<span class="linenos" data-linenos="2 "></span><span class="x">{</span>
<span class="linenos" data-linenos="3 "></span><span class="x">        return Genre::all()-&gt;toArray();</span>
<span class="linenos" data-linenos="4 "></span><span class="x">}</span>
</code></pre></div>
<p>Però aço no acaba de funcionar perquè torna un array d'esta forma</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    array:2 [▼</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">      0 =&gt; array:2 [▼</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">        &quot;id&quot; =&gt; 1</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">        &quot;titulo&quot; =&gt; &quot;Terror&quot;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">      ]</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">      1 =&gt; array:2 [▼</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">        &quot;id&quot; =&gt; 2</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        &quot;titulo&quot; =&gt; &quot;Fantástico&quot;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">      ]</span>
<span class="linenos" data-linenos="10 "></span><span class="x">    ]</span>
</code></pre></div>
<p>però per a que funcionara hauria de ser d'aquesta altra</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    array:2 [▼</span>
<span class="linenos" data-linenos="2 "></span><span class="x">      1 =&gt; &quot;Terror&quot;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">      2 =&gt; &quot;Fantástico&quot;</span>
<span class="linenos" data-linenos="4 "></span><span class="x">      ]</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    ]</span>
</code></pre></div>
<p>Aixì que anem a fer una funció genèrica php que donada una col.lecció d'objectes i dos camps del mateix, genere un array per a l'option.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>function hazArray($elementos,&#39;campo1&#39;,&#39;campo2&#39;)
<span class="linenos" data-linenos="2 "></span>{
<span class="linenos" data-linenos="3 "></span>    return $array
<span class="linenos" data-linenos="4 "></span>}
</code></pre></div>
<p>i la cridariem de la següent forma:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    public function getIdGenreOptions()</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    {</span>
<span class="linenos" data-linenos="3 "></span><span class="x">        return hazArray(Genre::all(),&#39;id&#39;,&#39;titulo&#39;);</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    }</span>
</code></pre></div>
<p>De moment declara-la com a privada en el model per a provar que funciona.</p>
<p><strong>Nota: en Laravel, per a poder vore el valor d'una variable i para l'execució del programa s'utilitza la funció dd($variable)</strong> </p>
<h4 id="helperserviceprovider">HelperServiceProvider<a class="headerlink" href="#helperserviceprovider" title="Permanent link">&para;</a></h4>
<p><a href="https://youtu.be/sFvxC6zXFjM"><img alt="" src="../../img/ull.png" />Video</a></p>
<p>Però, esta funció ha de poser ser visible en tota la  aplicació. Per tal de aconseguir-ho anem a crear un fitxer on guardar les nostres funcions genèriques.</p>
<ul>
<li>Crea una carpeta <strong>Helpers</strong> dins de <strong>app</strong></li>
<li>Crea un fitxer <strong>myHelpers</strong> dins d'aquesta carpeta.</li>
<li>copia la funció hazArray</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="k">function</span> <span class="nf">hazArray</span><span class="p">(</span><span class="nv">$elementos</span><span class="p">,</span> <span class="nv">$campo1</span><span class="p">,</span> <span class="nv">$campo2</span><span class="p">)</span>
<span class="linenos" data-linenos="4 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="5 "></span>        <span class="nv">$todos</span> <span class="o">=</span> <span class="p">[];</span>
<span class="linenos" data-linenos="6 "></span>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$elementos</span> <span class="k">as</span> <span class="nv">$elemento</span><span class="p">)</span>
<span class="linenos" data-linenos="7 "></span>            <span class="nv">$todos</span><span class="p">[</span><span class="nv">$elemento</span><span class="o">-&gt;</span><span class="nv">$campo1</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$elemento</span><span class="o">-&gt;</span><span class="nv">$campo2</span><span class="p">;</span>
<span class="linenos" data-linenos="8 "></span>        <span class="k">return</span> <span class="nv">$todos</span><span class="p">;</span>
<span class="linenos" data-linenos="9 "></span>    <span class="p">}</span>
</code></pre></div>
<p>Per a que les funcions d'aquest fitxer siguen visibles en l'aplicació anem a crear un ServiceProvider i a registrar-lo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php artisan make:provider HelperServiceProvider
</code></pre></div>
<p>Crearà un fitxer en la carpeta Providers.
L'editem per afegir el nostre Helper.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    /**</span>
<span class="linenos" data-linenos="2 "></span><span class="x">         * Register services.</span>
<span class="linenos" data-linenos="3 "></span><span class="x">         *</span>
<span class="linenos" data-linenos="4 "></span><span class="x">         * @return void</span>
<span class="linenos" data-linenos="5 "></span><span class="x">         */</span>
<span class="linenos" data-linenos="6 "></span><span class="x">        public function register()</span>
<span class="linenos" data-linenos="7 "></span><span class="x">        {</span>
<span class="linenos" data-linenos="8 "></span><span class="x">            require_once base_path() . &#39;/app/Helpers/myHelpers.php&#39;;</span>
<span class="linenos" data-linenos="9 "></span><span class="x">        }</span>
</code></pre></div>
<p>I ara registrem el ServiceProvider en el fitxer <strong>config/app.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">&#39;providers&#39; =&gt; [</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">        /*</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">         * Laravel Framework Service Providers...</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">         */</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">        Illuminate\Auth\AuthServiceProvider::class,</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        .....</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="x">        /*</span>
<span class="linenos" data-linenos="11 "></span><span class="x">         * Package Service Providers...</span>
<span class="linenos" data-linenos="12 "></span><span class="x">         */</span>
<span class="linenos" data-linenos="13 "></span>
<span class="linenos" data-linenos="14 "></span><span class="x">        /*</span>
<span class="linenos" data-linenos="15 "></span><span class="x">         * Application Service Providers...</span>
<span class="linenos" data-linenos="16 "></span><span class="x">         */</span>
<span class="linenos" data-linenos="17 "></span><span class="x">        App\Providers\AppServiceProvider::class,</span>
<span class="linenos" data-linenos="18 "></span><span class="x">        App\Providers\AuthServiceProvider::class,</span>
<span class="linenos" data-linenos="19 "></span><span class="x">        // App\Providers\BroadcastServiceProvider::class,</span>
<span class="linenos" data-linenos="20 "></span><span class="x">        App\Providers\EventServiceProvider::class,</span>
<span class="linenos" data-linenos="21 "></span><span class="x">        App\Providers\RouteServiceProvider::class,</span>
<span class="linenos" data-linenos="22 "></span><span class="x">        App\Providers\HelperServiceProvider::class,</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span><span class="x">    ],</span>
</code></pre></div>
<p>I com cada volta que toquen un fitxer de configuració executem</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php artisan config:cache
</code></pre></div>
<p>I tot ha de funcionar. Ja podem triar un gènere en cada pel.licula.</p>
<h3 id="el-component-de-menu-styde">El component de menu styde.<a class="headerlink" href="#el-component-de-menu-styde" title="Permanent link">&para;</a></h3>
<p><a href="https://youtu.be/_KFSmCnFkqM"><img alt="" src="../../img/ull.png" />Video</a></p>
<p>Anem a fer el menu des d'un fitxer de text utilitzan el component de menu del paquet instal.lat</p>
<p>Substituïm el navbar per :</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    &lt;nav class=&quot;navbar navbar-expand-md navbar-light navbar-laravel&quot;&gt;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">        &lt;div class=&quot;container&quot;&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">            &lt;a class=&quot;navbar-brand&quot; href=&quot;{{url(&#39;/&#39;)}}&quot;&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">                &lt;span class=&quot;glyphicon glyphicon-tower&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">                Videoclub</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">            &lt;/a&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">            &lt;button class=&quot;navbar-toggler&quot; type=&quot;button&quot; data-toggle=&quot;collapse&quot; data-target=&quot;#navbarSupportedContent&quot; aria-controls=&quot;navbarSupportedContent&quot; aria-expanded=&quot;false&quot; aria-label=&quot;{{ __(&#39;Toggle navigation&#39;) }}&quot;&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">                    &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">            &lt;/button&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="x">            @if( Auth::check() )</span>
<span class="linenos" data-linenos="11 "></span><span class="x">                {!! Menu::make(config(&#39;menu&#39;), &#39;navbar-nav mr-auto&#39;) !!}</span>
<span class="linenos" data-linenos="12 "></span><span class="x">            @endif</span>
<span class="linenos" data-linenos="13 "></span><span class="x">        &lt;/div&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">    &lt;/nav&gt;</span>
</code></pre></div>
<p>on config('menu') enllaça en un fitxer que hem de crear en la carpeta config i de nom menu.php. Este haurà de contindre:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span>    <span class="k">return</span> <span class="p">[</span>
<span class="linenos" data-linenos="4 "></span>        <span class="s1">&#39;catalogo&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/catalog&#39;</span><span class="p">],</span>
<span class="linenos" data-linenos="5 "></span>        <span class="s1">&#39;nueva&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Nueva Película&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/catalog/create&#39;</span><span class="p">],</span>
<span class="linenos" data-linenos="6 "></span>        <span class="s1">&#39;logout&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Cerrar Sesion&#39;</span> <span class="p">,</span><span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/logout&#39;</span><span class="p">]</span>
<span class="linenos" data-linenos="7 "></span>    <span class="p">];</span>
</code></pre></div>
<p><strong>Cal fer php artisan config:cache</strong></p>
<p>On estan les opcions de menu.</p>
<h3 id="completant-botons">Completant botons<a class="headerlink" href="#completant-botons" title="Permanent link">&para;</a></h3>
<p>En aquest exercici anem a afegir la funcionalitat dels botons de llogar, retornar i eliminar pel·lícules. En tots els casos haurem de crear una nova ruta, un nou mètode en el controlador , actualitzar el boton en la vista i mostrar una notificació despres de realitzar l'acció. En la següent taula es mostra un resum de la nova ruta a afegir:</p>
<table>
<thead>
<tr>
<th>Ruta</th>
<th>Tipus</th>
<th>Controlador/Acció</th>
</tr>
</thead>
<tbody>
<tr>
<td>/catalog/rent/{id}</td>
<td>PUT</td>
<td>CatalogController@putRent</td>
</tr>
<tr>
<td>/catalog/return/{id}</td>
<td>PUT</td>
<td>CatalogController@putReturn</td>
</tr>
<tr>
<td>/catalog/delete/{id}</td>
<td>DELETE</td>
<td>CatalogController@deleteMovie</td>
</tr>
</tbody>
</table>
<p>Aquests tres mètodes són similars al mètode que ja havíem implementat abans per a editar les dades d'una pel.lícula. En el cas de <strong>putRent</strong> i <strong>putReturn</strong> únicament modificarem el camp <strong>rented</strong> assignant-li el valor true i false respectivament i una vegada guardat crearem la notificació i realitzarem una redirecció a la pantalla amb la vista detalle de la pel.lícula. En el mètode deleteMovie també obtindrem el registre de la pel·lícula però haurem de cridar al mètode delete() de la mateixa, una vegada fet açò afegirem la notificació i realitzarem una redirecció al llistat general de pel·lícules.</p>
<p>A continuació hem d'editar la vista detalle de pel·lícules per a modificar els botons (show.blade). Atès que les accions han de realitzaren utilitzant peticions HTTP tipus PUT i DELETE no podem posar un enllaç normal (ja que seria de tipus GET). Per a solucionar-ho hem de crear un formulari al voltant del botó i assignar al formulari el mètode corresponent.</p>
<p>Per exemple:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    &lt;form action= {{action(&#39;CatalogController@putReturn&#39;,$pelicula-&gt;id)}} method=&quot;POST&quot; style=&quot;display:inline&quot;&gt;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">        {{ method_field(&#39;PUT&#39;) }}</span>
<span class="linenos" data-linenos="3 "></span><span class="x">        {{ csrf_field() }}</span>
<span class="linenos" data-linenos="4 "></span><span class="x">        &lt;button type=&quot;submit&quot; class=&quot;btn btn-danguer&quot; style= &quot;display:inline&quot; &gt; Devolver Película&lt;/button&gt;</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    &lt;/form&gt;</span>
</code></pre></div>
<h3 id="fes-un-manteniment-per-a-la-taula-de-generes-i-fica-la-al-menu">Fes un manteniment per a la taula de gèneres i fica-la al menu.<a class="headerlink" href="#fes-un-manteniment-per-a-la-taula-de-generes-i-fica-la-al-menu" title="Permanent link">&para;</a></h3>
<p>Per a fer submenus amb styde :</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    return [</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">        &#39;catalogo&#39; =&gt; [ &#39;submenu&#39; =&gt; [</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">                &#39;lista&#39; =&gt;[ &#39;title&#39;=&gt; &#39;Catálogo&#39;, &#39;url&#39; =&gt; &#39;/catalog&#39;],</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">                &#39;nueva&#39; =&gt; [&#39;title&#39; =&gt; &#39;Nueva Película&#39;, &#39;url&#39; =&gt; &#39;/catalog/create&#39;],</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">            ]],</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">            &#39;genero&#39; =&gt; [&#39;submenu&#39; =&gt; [ </span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">                &#39;genre&#39; =&gt; [&#39;title&#39; =&gt; &#39;Mantenimiento Generos&#39; , &#39;url&#39; =&gt; &#39;/genre&#39;],</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">                &#39;nuevo&#39; =&gt; [&#39;title&#39; =&gt; &#39;Nuevo Genero&#39;, &#39;url&#39; =&gt; &#39;/genre/create&#39;]</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">                ]],</span>
<span class="linenos" data-linenos="10 "></span><span class="x">        &#39;logout&#39; =&gt; [&#39;title&#39; =&gt; &#39;Cerrar Sesion&#39; ,&#39;url&#39; =&gt; &#39;/logout&#39;]</span>
<span class="linenos" data-linenos="11 "></span><span class="x">    ];</span>
</code></pre></div>
<p>web.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">        Route::put(&#39;catalog/return/{id}&#39;,&#39;catalogController@putReturn&#39;);</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    Route::put(&#39;catalog/rent/{id}&#39;,&#39;catalogController@putRent&#39;);</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    Route::delete(&#39;catalog/{id}&#39;,&#39;catalogController@deleteMovie&#39;); </span>
</code></pre></div>
<p>catalogController</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">public function putRent($id){</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">        $pelicula = Movie::findOrFail($id);</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">        $pelicula-&gt;rented = true;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">        $pelicula-&gt;save();</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">        return redirect(&quot;/catalog/show/$id&quot;);</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">    }</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">    public function putReturn($id){</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">        $pelicula = Movie::findOrFail($id);</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        $pelicula-&gt;rented = false;</span>
<span class="linenos" data-linenos="10 "></span><span class="x">        $pelicula-&gt;save();</span>
<span class="linenos" data-linenos="11 "></span><span class="x">        return redirect(&quot;/catalog/show/$id&quot;);</span>
<span class="linenos" data-linenos="12 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="13 "></span><span class="x">    public function deleteMovie($id){</span>
<span class="linenos" data-linenos="14 "></span><span class="x">        Movie::findOrFail($id)-&gt;delete();</span>
<span class="linenos" data-linenos="15 "></span><span class="x">        return redirect(&quot;/catalog&quot;);</span>
<span class="linenos" data-linenos="16 "></span><span class="x">    }</span>
</code></pre></div>
<p>show.blade.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x"> @if ($pelicula-&gt;rented)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">                    &lt;form action= {{action(&#39;catalogController@putReturn&#39;,$pelicula-&gt;id)}} method=&quot;POST&quot; style=&quot;display:inline&quot;&gt;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">                        {{ method_field(&#39;PUT&#39;) }}</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">                        @csrf</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">                        &lt;button type=&quot;submit&quot; class=&quot;btn btn-info&quot; &gt; Tornar Película&lt;/button&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">                    &lt;/form&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">                @else</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">                    &lt;form action= {{action(&#39;catalogController@putRent&#39;,$pelicula-&gt;id)}} method=&quot;POST&quot; style=&quot;display:inline&quot;&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">                        {{ method_field(&#39;PUT&#39;) }}</span>
<span class="linenos" data-linenos="10 "></span><span class="x">                        @csrf</span>
<span class="linenos" data-linenos="11 "></span><span class="x">                        &lt;button type=&quot;submit&quot; class=&quot;btn btn-secondary&quot; &gt; Llogar Película&lt;/button&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">                    &lt;/form&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">                    &lt;form action= {{action(&#39;catalogController@deleteMovie&#39;,$pelicula-&gt;id)}} method=&quot;POST&quot; style=&quot;display:inline&quot;&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">                        {{ method_field(&#39;DELETE&#39;) }}</span>
<span class="linenos" data-linenos="15 "></span><span class="x">                        @csrf</span>
<span class="linenos" data-linenos="16 "></span><span class="x">                        &lt;button type=&quot;submit&quot; class=&quot;btn btn-danger&quot;  &gt; Esborrar Película&lt;/button&gt;</span>
<span class="linenos" data-linenos="17 "></span><span class="x">                    &lt;/form&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x">                @endif</span>
<span class="linenos" data-linenos="19 "></span><span class="x">    @endif</span>
</code></pre></div>
<p>web.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">Route::get(&#39;genre&#39;,&#39;genreController@getIndex&#39;);</span>
<span class="linenos" data-linenos="2 "></span><span class="x">Route::get(&#39;genre/create&#39;,&#39;genreController@getCreate&#39;);</span>
<span class="linenos" data-linenos="3 "></span><span class="x">Route::post(&#39;genre/create&#39;,&#39;genreController@postCreate&#39;);</span>
<span class="linenos" data-linenos="4 "></span><span class="x">Route::get(&#39;genre/edit/{id}&#39;,&#39;genreController@getEdit&#39;);</span>
<span class="linenos" data-linenos="5 "></span><span class="x">Route::put(&#39;genre/edit/{id}&#39;,&#39;genreController@putEdit&#39;);</span>
<span class="linenos" data-linenos="6 "></span><span class="x">Route::get(&#39;genre/delete/{id}&#39;,&#39;genreController@delete&#39;);</span>
</code></pre></div>
<p>genreController.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="k">use</span> <span class="nx">App\Genre</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="k">class</span> <span class="nc">GenreController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="linenos" data-linenos="10 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getIndex</span><span class="p">(){</span>
<span class="linenos" data-linenos="12 "></span>            <span class="nv">$generos</span> <span class="o">=</span> <span class="nx">Genre</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>
<span class="linenos" data-linenos="13 "></span>            <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;genre.index&#39;</span><span class="p">,</span><span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;generos&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos="14 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getCreate</span><span class="p">(){</span>
<span class="linenos" data-linenos="17 "></span>            <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;genre.create&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="18 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="19 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">postCreate</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">){</span>
<span class="linenos" data-linenos="20 "></span>            <span class="nv">$genre</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Genre</span><span class="p">();</span>
<span class="linenos" data-linenos="21 "></span>            <span class="nv">$genre</span><span class="o">-&gt;</span><span class="na">fill</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">());</span>
<span class="linenos" data-linenos="22 "></span>            <span class="nv">$genre</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="linenos" data-linenos="23 "></span>            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/genre&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="24 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="25 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">getEdit</span><span class="p">(</span><span class="nv">$id</span><span class="p">){</span>
<span class="linenos" data-linenos="26 "></span>            <span class="nv">$genre</span> <span class="o">=</span> <span class="nx">Genre</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos="27 "></span>            <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;genre.edit&#39;</span><span class="p">,</span><span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;genre&#39;</span><span class="p">));</span>
<span class="linenos" data-linenos="28 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="29 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">putEdit</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span><span class="nv">$id</span><span class="p">){</span>
<span class="linenos" data-linenos="30 "></span>            <span class="nv">$genre</span> <span class="o">=</span> <span class="nx">Genre</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="linenos" data-linenos="31 "></span>            <span class="nv">$genre</span><span class="o">-&gt;</span><span class="na">fill</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">());</span>
<span class="linenos" data-linenos="32 "></span>            <span class="nv">$genre</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="linenos" data-linenos="33 "></span>            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s2">&quot;/genre&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="34 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="35 "></span>        <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nv">$id</span><span class="p">){</span>
<span class="linenos" data-linenos="36 "></span>            <span class="nx">Genre</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
<span class="linenos" data-linenos="37 "></span>            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s2">&quot;/genre&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos="38 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="39 "></span>    <span class="p">}</span>
</code></pre></div>
<p>create.blade.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">@extends(&#39;layouts.master&#39;)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    @section(&#39;content&#39;)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">    &lt;div class=&quot;row&quot; style=&quot;margin-top:20px&quot;&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">        &lt;div class=&quot;col-md-offset-3 col-md-6&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">            &lt;div class=&quot;panel panel-default&quot;&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">                &lt;div class=&quot;panel-heading&quot;&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">                    &lt;h3 class=&quot;panel-title text-center&quot;&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">                        &lt;span class=&quot;glyphicon glyphicon-film&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">                        Afegir gènere</span>
<span class="linenos" data-linenos="10 "></span><span class="x">                    &lt;/h3&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">                &lt;/div&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">                &lt;div class=&quot;panel-body&quot; style=&quot;padding:30px&quot;&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">                    {!! Form::model(new App\Genre,[&#39;class&#39;=&gt;&#39;form-horizontal form-label-left&#39;,&#39;enctype&#39;=&gt;&quot;multipart/form-data&quot;]) !!}</span>
<span class="linenos" data-linenos="14 "></span><span class="x">                        {!! Field::text(&#39;title&#39;) !!}</span>
<span class="linenos" data-linenos="15 "></span><span class="x">                        {!! Form::submit(&#39;Enviar&#39;,[&#39;class&#39;=&gt;&#39;btn btn-success&#39;,&#39;id&#39;=&gt;&#39;submit&#39;]) !!}</span>
<span class="linenos" data-linenos="16 "></span><span class="x">                    {!! Form::close() !!}</span>
<span class="linenos" data-linenos="17 "></span><span class="x">                &lt;/div&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x">            &lt;/div&gt;</span>
<span class="linenos" data-linenos="19 "></span><span class="x">        &lt;/div&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">    &lt;/div&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">    @stop</span>
</code></pre></div>
<p>edit.blade.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    @extends(&#39;layouts.master&#39;)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    @section(&#39;content&#39;)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">    &lt;div class=&quot;row&quot; style=&quot;margin-top:20px&quot;&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">        &lt;div class=&quot;col-md-offset-3 col-md-6&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">            &lt;div class=&quot;panel panel-default&quot;&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">                &lt;div class=&quot;panel-heading&quot;&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">                    &lt;h3 class=&quot;panel-title text-center&quot;&gt;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">                        &lt;span class=&quot;glyphicon glyphicon-film&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">                        Modificar Genere</span>
<span class="linenos" data-linenos="10 "></span><span class="x">                    &lt;/h3&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">                &lt;/div&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">                {!! Form::model($genre,[&#39;class&#39;=&gt;&#39;form-horizontal form-label-left&#39;,&#39;enctype&#39;=&gt;&quot;multipart/form-data&quot;]) !!}</span>
<span class="linenos" data-linenos="13 "></span><span class="x">                    @method(&#39;PUT&#39;)</span>
<span class="linenos" data-linenos="14 "></span><span class="x">                    {!! Field::text(&#39;title&#39;) !!}</span>
<span class="linenos" data-linenos="15 "></span><span class="x">                {!! Form::submit(&#39;Enviar&#39;,[&#39;class&#39;=&gt;&#39;btn btn-success&#39;,&#39;id&#39;=&gt;&#39;submit&#39;]) !!}</span>
<span class="linenos" data-linenos="16 "></span><span class="x">                {!! Form::close() !!}</span>
<span class="linenos" data-linenos="17 "></span><span class="x">            &lt;/div&gt;</span>
<span class="linenos" data-linenos="18 "></span><span class="x">        &lt;/div&gt;</span>
<span class="linenos" data-linenos="19 "></span><span class="x">    &lt;/div&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">    &lt;/div&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">    @stop</span>
</code></pre></div>
<p>index.blade.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    @extends(&#39;layouts.master&#39;)</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">    @section(&#39;content&#39;)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">    &lt;h2 &gt;Gèneres&lt;/h2&gt;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">        &lt;div class=&quot;row&quot;&gt;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">            &lt;table class=&quot;table-bordered table-info&quot;&gt;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">                &lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;Titulo&lt;/th&gt;&lt;th&gt;Operacion&lt;/th&gt;&lt;/tr&gt;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">                @foreach( $generos as $genero )        </span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">                &lt;tr&gt;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">                    &lt;td&gt;{{$genero-&gt;id}}&lt;/td&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="x">                    &lt;td&gt;{{$genero-&gt;title}}&lt;/td&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">                    &lt;td&gt;&lt;a href=&#39;/genre/edit/{{$genero-&gt;id}}&#39;&gt;&lt;i class=&#39;fa fa-edit&#39;&gt;&lt;/i&gt;&lt;/a&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">                        &lt;a href=&#39;/genre/delete/{{$genero-&gt;id}}&#39;&gt;&lt;i class=&#39;fa fa-trash&#39;&gt;&lt;/i&gt;&lt;/a&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">                    &lt;/td&gt;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">                &lt;/tr&gt;</span>
<span class="linenos" data-linenos="15 "></span><span class="x">                @endforeach</span>
<span class="linenos" data-linenos="16 "></span><span class="x">            &lt;/table&gt;</span>
<span class="linenos" data-linenos="17 "></span><span class="x">        &lt;/div&gt;  </span>
<span class="linenos" data-linenos="18 "></span><span class="x">    @stop</span>
</code></pre></div>
<h3 id="alertes">Alertes<a class="headerlink" href="#alertes" title="Permanent link">&para;</a></h3>
<p><a href="https://youtu.be/y-zb8hB2GD4"><img alt="" src="../../img/ull.png" />Video</a></p>
<p>El component d'Styde te un sistema de notificacions. Per a fer-lo servir cal possar en la vista on volem que ixquen les notificacions. En el nostre cas serà en la plantilla, després de mostrar el contingut:</p>
<p>master.blade.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    ...</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    &lt;div id=&#39;app&#39; class=&quot;container&quot;&gt; </span>
<span class="linenos" data-linenos="3 "></span><span class="x">        @yield(&#39;content&#39;)</span>
<span class="linenos" data-linenos="4 "></span><span class="x">        {!! Alert::render() !!}</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    &lt;/div&gt;</span>
<span class="linenos" data-linenos="6 "></span><span class="x">    ...</span>
</code></pre></div>
<p>I ara quan guardem una pel.licula podem mostrar una notificació a l'usuari:</p>
<p>CatalogController.php</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    ...</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    public function postCreate(StoreMovie $request){</span>
<span class="linenos" data-linenos="3 "></span><span class="x">        $movie = new Movie();</span>
<span class="linenos" data-linenos="4 "></span><span class="x">        $movie-&gt;fill($request-&gt;toArray());</span>
<span class="linenos" data-linenos="5 "></span><span class="x">        $movie-&gt;save();</span>
<span class="linenos" data-linenos="6 "></span><span class="x">        Alert::success(&quot;S&#39;ha guardat la pel.licula&quot;);</span>
<span class="linenos" data-linenos="7 "></span><span class="x">        return redirect(&#39;/catalog&#39;);</span>
<span class="linenos" data-linenos="8 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="9 "></span><span class="x">    ...</span>
</code></pre></div>
<h3 id="acces-login-en-una-app-amb-socialite">ACCÉS (LOGIN) EN UNA APP AMB SOCIALITE<a class="headerlink" href="#acces-login-en-una-app-amb-socialite" title="Permanent link">&para;</a></h3>
<p><a href="https://youtu.be/aNIG2wYKPPA"><img alt="" src="../../img/ull.png" />Video</a></p>
<p>Laravel disposa d'un paquet oficial, anomenat Laravel Socialite que ens ofereix una via ràpida i fàcil, per a oferir una forma d'autenticació amb proveïdors de OAuth, suportant de forma oficial a la data, Facebook, Twitter, LinkedIn, Google, GitHub i Bitbucket. Pot ser estès amb facilitat implementant el paquet Socialite Providers</p>
<p>Per fer un sistema d'autenticació per <a href="https://castris.com/acceso-login-en-una-app-de-laravel-5-7-con-socialite/">Facebook</a></p>
<h3 id="control-de-qui-lloga-la-pellicula">Control de qui lloga la pel.licula.<a class="headerlink" href="#control-de-qui-lloga-la-pellicula" title="Permanent link">&para;</a></h3>
<p><a href="https://youtu.be/E-wOk2kCVSQ"><img alt="" src="../../img/ull.png" />Video</a></p>
<p>Cada volta que un usuari lloga un pel.licula anem a apuntar-ho en una taula <strong>rents</strong>. </p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>php artisan make:migration create_rents_table
</code></pre></div>
<ul>
<li>Crearem la migració amb els camps per a la taula <strong>rents</strong>: id, id_user, id_movie, dateRent, dateReturn i amb les claus fonànies corresponents i creem les relaciones molts a molts entre els models movie i users. </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">    </span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schema</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="k">class</span> <span class="nc">CreateRentsTable</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="linenos" data-linenos=" 8 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 9 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="10 "></span><span class="sd">     * Run the migrations.</span>
<span class="linenos" data-linenos="11 "></span><span class="sd">     *</span>
<span class="linenos" data-linenos="12 "></span><span class="sd">     * @return void</span>
<span class="linenos" data-linenos="13 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="14 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
<span class="linenos" data-linenos="15 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="16 "></span>        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;rents&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span>
<span class="linenos" data-linenos="17 "></span>        <span class="p">{</span>
<span class="linenos" data-linenos="18 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="19 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">&#39;id_movie&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">unsigned</span><span class="p">();</span>
<span class="linenos" data-linenos="20 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">&#39;id_user&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">unsigned</span><span class="p">();</span>
<span class="linenos" data-linenos="21 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">date</span><span class="p">(</span><span class="s1">&#39;dateRent&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="linenos" data-linenos="22 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">date</span><span class="p">(</span><span class="s1">&#39;dateReturn&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
<span class="linenos" data-linenos="23 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">foreign</span><span class="p">(</span><span class="s1">&#39;id_movie&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">references</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">on</span><span class="p">(</span><span class="s1">&#39;movies&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">onUpdate</span><span class="p">(</span><span class="s1">&#39;CASCADE&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">onDelete</span><span class="p">(</span><span class="s1">&#39;CASCADE&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="24 "></span>            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">foreign</span><span class="p">(</span><span class="s1">&#39;id_user&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">references</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">on</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">onUpdate</span><span class="p">(</span><span class="s1">&#39;CASCADE&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">onDelete</span><span class="p">(</span><span class="s1">&#39;CASCADE&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="25 "></span>        <span class="p">});</span>
<span class="linenos" data-linenos="26 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="27 "></span>
<span class="linenos" data-linenos="28 "></span>    <span class="sd">/**</span>
<span class="linenos" data-linenos="29 "></span><span class="sd">     * Reverse the migrations.</span>
<span class="linenos" data-linenos="30 "></span><span class="sd">     *</span>
<span class="linenos" data-linenos="31 "></span><span class="sd">     * @return void</span>
<span class="linenos" data-linenos="32 "></span><span class="sd">     */</span>
<span class="linenos" data-linenos="33 "></span>    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
<span class="linenos" data-linenos="34 "></span>    <span class="p">{</span>
<span class="linenos" data-linenos="35 "></span>        <span class="nx">Schema</span><span class="o">::</span><span class="na">dropIfExists</span><span class="p">(</span><span class="s1">&#39;rents&#39;</span><span class="p">);</span>
<span class="linenos" data-linenos="36 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="37 "></span><span class="p">}</span>
</code></pre></div>
<p><strong>Movie.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">public function users(){</span>
<span class="linenos" data-linenos="2 "></span><span class="x">        return $this-&gt;belongstoMany(User::class,&#39;rents&#39;,&#39;id_movie&#39;, &#39;id_user&#39;)-&gt;withPivot([&#39;dateRent&#39;,&#39;dateReturn&#39;]);</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    }</span>
</code></pre></div>
<p><strong>User.php</strong></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">public function movies(){</span>
<span class="linenos" data-linenos="2 "></span><span class="x">        return $this-&gt;belongstoMany(Movie::class,&#39;rents&#39;,&#39;id_user&#39;, &#39;id_movie&#39;)-&gt;withPivot([&#39;dateRent&#39;,&#39;dateReturn&#39;]);</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    }</span>
</code></pre></div>
<ul>
<li>
<p>Fem que quan un usuari llogue s'afegisca un enllaç de la rel.lació:</p>
<ul>
<li>Utilitzarem la funció attach de la rel.lació i transaccions per fer les dos operacions o cap.</li>
<li>Utilitza la funció updateExistingPivot per a tornar la pel.licula, ja que la relació ja existeix.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x"> public function putRent($id){</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">        DB::transaction(function () use($id) {</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">            $pelicula = Movie::findOrFail($id);</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">            $pelicula-&gt;rented = true;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">            $pelicula-&gt;save();</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">            $pelicula-&gt;users()-&gt;attach(Auth::id(), [&#39;dateRent&#39; =&gt; date(&#39;Y/m/d&#39;)]);</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">        });</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">        return redirect(&quot;/catalog/show/$id&quot;);</span>
<span class="linenos" data-linenos="10 "></span><span class="x">    }</span>
<span class="linenos" data-linenos="11 "></span><span class="x">    public function putReturn($id){</span>
<span class="linenos" data-linenos="12 "></span><span class="x">        DB::transaction(function () use($id){</span>
<span class="linenos" data-linenos="13 "></span><span class="x">            $pelicula = Movie::findOrFail($id);</span>
<span class="linenos" data-linenos="14 "></span><span class="x">            $pelicula = Movie::findOrFail($id);</span>
<span class="linenos" data-linenos="15 "></span><span class="x">            $pelicula-&gt;rented = false;</span>
<span class="linenos" data-linenos="16 "></span><span class="x">            $pelicula-&gt;save();</span>
<span class="linenos" data-linenos="17 "></span><span class="x">            $pelicula-&gt;users()-&gt;updateExistingPivot(Auth::id(), [&#39;dateReturn&#39; =&gt;date(&#39;Y/m/d&#39;)]);</span>
<span class="linenos" data-linenos="18 "></span><span class="x">        });</span>
<span class="linenos" data-linenos="19 "></span><span class="x">        return redirect(&quot;/catalog/show/$id&quot;);</span>
<span class="linenos" data-linenos="20 "></span><span class="x">    }</span>
</code></pre></div>
<h3 id="que-un-usuari-no-puga-retornar-una-pellicula-que-no-te-llogada">Que un usuari no puga retornar una pel.licula que no te llogada.<a class="headerlink" href="#que-un-usuari-no-puga-retornar-una-pellicula-que-no-te-llogada" title="Permanent link">&para;</a></h3>
<ul>
<li>Per a fer-ho més senzill anem a definir una altra rel.lació en la taula users que incloga les pel.licules de l'usuari que el camp dateReturn siga null</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x"> public function rent_movies(){</span>
<span class="linenos" data-linenos="2 "></span><span class="x">        return $this-&gt;belongsToMany(Movie::class,&#39;rents&#39;,&#39;id_user&#39;, &#39;id:movie&#39;)-&gt;withPivot([&#39;dateRent&#39;,&#39;dateReturn&#39;])-&gt;wherePivot(&#39;dateReturn&#39;,null);</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    }</span>
</code></pre></div>
<ul>
<li>Utilitzan esta relació en la vista mostrarem el botó de retornar soles si la pel.licula està entre les llogades per l'usuari. Una rel.lació torna una col.lecció (<a href="https://laravel.com/docs/6.0/collections">collection</a>). Anem a utilitzar el mètodo contains de la col.lecció:<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>@if (Auth::user()-&gt;rent_movies-&gt;contains($pelicula))
</code></pre></div>
</li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2024 Xavier Sastre - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "toc.integrate", "content.tabs.link", "navigation.expand"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiat al porta-retalls", "clipboard.copy": "C\u00f2pia al porta-retalls", "search.result.more.one": "1 m\u00e9s en aquesta p\u00e0gina", "search.result.more.other": "# m\u00e9s en aquesta p\u00e0gina", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.term.missing": "Desaparegut", "select.version": "Selecciona la versi\u00f3"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>