
<!doctype html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://xsastre.github.io/3.Formularis.html">
      
      
      
      
      <link rel="icon" href="imagenes/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.9">
    
    
      
        <title>Formularis i fitxers - Docencia Xavier</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans+Condensed:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"IBM Plex Sans Condensed";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#formularis-i-fitxers" class="md-skip">
          Salta el contingut
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Capçalera">
    <a href="." title="Docencia Xavier" class="md-header__button md-logo" aria-label="Docencia Xavier" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Docencia Xavier
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Formularis i fitxers
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="Teal"  aria-label="Canviar a mode dia"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Canviar a mode dia" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Neteja" aria-label="Neteja" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicialitzant cerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegació" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Docencia Xavier" class="md-nav__button md-logo" aria-label="Docencia Xavier" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Docencia Xavier
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Inici
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Inici
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inici
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DWEC
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            DWEC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Moduls/DWEC/_DWEC2425.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Desenvolupament web en entorn client - DAW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Moduls/DWEC/desenvolupamentfrontend.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Desenvolupamet frontend
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AW
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            AW
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Moduls/AW/00.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Temporització aproximada
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Moduls/AW/01.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UT01 Aplicacions web
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Moduls/AW/02.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UT02 HTML
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="formularis-i-fitxers">Formularis i fitxers<a class="headerlink" href="#formularis-i-fitxers" title="Permanent link">&para;</a></h1>
<h2 id="formularis">Formularis<a class="headerlink" href="#formularis" title="Permanent link">&para;</a></h2>
<p><a href="https://youtu.be/Eon9gTvOjco"><img alt="" src="../img/ull.png" />Video</a></p>
<h3 id="pas-de-parametres">Pas de paràmetres<a class="headerlink" href="#pas-de-parametres" title="Permanent link">&para;</a></h3>
<p>Una <strong>petició http</strong> és la sol·licitud d'un recurs al servidor:
  * Es realitzen a través d'una url
  * Es poden passar paràmetres amb la petició
* Hi ha diferents mètodes (<strong>METHOD</strong>) de realitzar una petició <strong>(GET, POST, PUT, DELETE, PATCH, etc.)</strong>, encara que els més habituals són GET i POST</p>
<h4 id="peticio-get">Petició GET<a class="headerlink" href="#peticio-get" title="Permanent link">&para;</a></h4>
<ul>
<li>S'utilitza per a sol·licitar dades d'un recurs</li>
<li>Es Mostren els paràmetres que s'envien en la url</li>
<li>Es poden utilitzar directament en enllaços</li>
<li>Romanen en l'historial del navegador</li>
<li>La grandària dels paràmetres està limitat a 255 caràcters</li>
</ul>
<p><img alt="" src="../img/t207.png" /></p>
<p><img alt="" src="../img/t208.png" /></p>
<h5 id="accedir-a-les-dades-de-la-peticio-get">Accedir a les dades de la petició GET<a class="headerlink" href="#accedir-a-les-dades-de-la-peticio-get" title="Permanent link">&para;</a></h5>
<ul>
<li>Usem la variable superglobal <strong>$_GET</strong></li>
<li>És un array associatiu</li>
<li>Les claus del array coincidiran amb els noms que li hem donat als paràmetres.</li>
<li>Per a accedir als paràmetres de la petició anterior:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">echo $_GET[&#39;nom&#39;] . &#39; &#39; . $_GET[&#39;cognom&#39;];</span>
</code></pre></div>
<h5 id="evitar-el-csrf">Evitar el CSRF<a class="headerlink" href="#evitar-el-csrf" title="Permanent link">&para;</a></h5>
<p><a href="../img/ull.png"></a>Video](https://youtu.be/qywV3Im17kk)</p>
<p>En tota pàgina que reba paràmetres GET has de comprovar el <strong>HTTP referer</strong> del navegador, i que aquest siga de dins de la teua web. En php el referer que envia el navegador s'emmagatzema en $_*SERVER['HTTP_REFERER']</p>
<p>Seria tal com:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">if( parse_url($_SERVER[&#39;HTTP_REFERER&#39;], PHP_URL_HOST) != $_SERVER[&#39;HTTP_HOST&#39;]) die(&#39;Anti-CSRF&#39;); </span>
</code></pre></div>
<p>NOTA IMPORTANT
Amb aquest codi estem obligant al fet que el navegador envie un referer si o sí. Per tant només ha d'utilitzar-se en pàgines a les quals el navegador accedisca des d'una altra pàgina de la nostra web.
Òbviament no podem col·locar-ho en la primera pàgina a la qual s'accedeix a la nostra web (index.php o similar), ja que si l'usuari a escrit l'adreça a mà en la barra del navegador no s'enviarà referer cap i saltarà el sistema.</p>
<h3 id="peticio-post">Petició POST<a class="headerlink" href="#peticio-post" title="Permanent link">&para;</a></h3>
<ul>
<li>S'utilitza per a enviar dades a un recurs</li>
<li>Els paràmetres van en el cos de la petició, no són visibles per a l'usuari</li>
<li>No es pot utilitzar en un enllaç</li>
<li>No roman en l'historial</li>
<li>Se solen utilitzar en els formularis</li>
<li>No tenim la limitació de grandària dels paràmetres</li>
</ul>
<p><img alt="" src="../img/t209.png" /></p>
<p><img alt="" src="../img/t210.png" /></p>
<h5 id="accedir-a-les-dades-de-la-peticio-post">Accedir a les dades de la petició POST<a class="headerlink" href="#accedir-a-les-dades-de-la-peticio-post" title="Permanent link">&para;</a></h5>
<ul>
<li>Usem la variable superglobal <strong>$_POST</strong></li>
<li>Funciona igual que $_GET.</li>
<li>Mostrar totes les dades rebudes:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">var_dump($_POST);</span>
</code></pre></div>
<ul>
<li>Mostrar les dades individualment:</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">echo $_POST[&#39;nom&#39;]; echo $_POST[&#39;cognom&#39;];</span>
</code></pre></div>
Al crear un formulari li assignem un metode (habitualment POST) i una destinació (pàgina que tractarà el formulari)</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">&lt;form method=&#39;POST&#39; action=&#39;pagina.php&#39;&gt;</span>
</code></pre></div>
<h4 id="enviar-les-dades-al-mateix-script-que-mostra-el-formulari">Enviar les dades al mateix script que mostra el formulari<a class="headerlink" href="#enviar-les-dades-al-mateix-script-que-mostra-el-formulari" title="Permanent link">&para;</a></h4>
<p>És habitual que la pàgina que tracta el formulari siga la mateixa que la que el conté. Per poder fer-ho: </p>
<ul>
<li>La variable <strong>$_SERVER</strong> conté dades relacionades amb l'entorn del servidor de la petició HTTP</li>
<li>
<p>Una de les dades que conté és el script php que s'està executant <strong>($_SERVER['PHP_SELF'])</strong>. Si indiquem el action del formulari així: <strong>action="\&lt;?= $_SERVER['PHP_SELF']; ?&gt;"</strong>, serà la pròpia pàgina del formulari la que processe les dades.</p>
</li>
<li>
<p>Si és així haurem de programar dos blocs:</p>
<ul>
<li>Un inicial de comprovació que s'executa quan s'accedix pel mètode POST,es a dir, a l'enviar el formulari. Si les dades són correctes es processarà el formulari. En cas contrari es crea la variable <strong>$err</strong> i continua l'script.</li>
<li>L'HTML, que s'executa quan s'accedix mitjançant GET (no ve del formulari) o després d'executar el primer bloc, si així ho volem.</li>
</ul>
</li>
</ul>
<h5 id="verificar-que-el-formulari-sha-enviat">Verificar que el formulari s'ha enviat<a class="headerlink" href="#verificar-que-el-formulari-sha-enviat" title="Permanent link">&para;</a></h5>
<ul>
<li>Abans de mostrar les dades verificarem que s'haja enviat el formulari:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span><span class="cm">/* si va bien redirige a principal.php si va mal, mensaje de error */</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;REQUEST_METHOD&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">)</span> <span class="p">{</span>  
<span class="linenos" data-linenos=" 4 "></span>        <span class="k">if</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;usuario&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;usuario&quot;</span> <span class="k">and</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;clave&quot;</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;1234&quot;</span><span class="p">){</span>     <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location: principal.php&quot;</span><span class="p">);</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span>            <span class="nv">$err</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="p">}</span>   
<span class="linenos" data-linenos=" 8 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 9 "></span><span class="cp">?&gt;</span>
<span class="linenos" data-linenos="10 "></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="linenos" data-linenos="11 "></span><span class="x">&lt;html&gt;</span>
<span class="linenos" data-linenos="12 "></span><span class="x">    &lt;head&gt;</span>
<span class="linenos" data-linenos="13 "></span><span class="x">        &lt;title&gt;Formulario de login&lt;/title&gt;      </span>
<span class="linenos" data-linenos="14 "></span><span class="x">        &lt;meta charset = &quot;UTF-8&quot;&gt;</span>
<span class="linenos" data-linenos="15 "></span><span class="x">    &lt;/head&gt;</span>
<span class="linenos" data-linenos="16 "></span><span class="x">    &lt;body&gt;          </span>
<span class="linenos" data-linenos="17 "></span><span class="x">        </span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$err</span><span class="p">)){</span>
<span class="linenos" data-linenos="18 "></span>            <span class="k">echo</span> <span class="s2">&quot;&lt;p&gt; Revise usuario y contraseña&lt;/p&gt;&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="19 "></span>        <span class="p">}</span><span class="cp">?&gt;</span>
<span class="linenos" data-linenos="20 "></span><span class="x">        &lt;form action = &quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;PHP_SELF&quot;</span><span class="p">]);</span><span class="cp">?&gt;</span><span class="x">&quot; method = &quot;POST&quot;&gt;</span>
<span class="linenos" data-linenos="21 "></span><span class="x">            &lt;label for = &quot;usuario&quot;&gt;Usuario&lt;/label&gt; </span>
<span class="linenos" data-linenos="22 "></span><span class="x">            &lt;input value = &quot;</span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$usuario</span><span class="p">))</span><span class="k">echo</span> <span class="nv">$usuario</span><span class="p">;</span><span class="cp">?&gt;</span><span class="x">&quot;</span>
<span class="linenos" data-linenos="23 "></span><span class="x">            id = &quot;usuario&quot; name = &quot;usuario&quot; type = &quot;text&quot;&gt;              </span>
<span class="linenos" data-linenos="24 "></span>
<span class="linenos" data-linenos="25 "></span><span class="x">            &lt;label for = &quot;clave&quot;&gt;Clave&lt;/label&gt; </span>
<span class="linenos" data-linenos="26 "></span><span class="x">            &lt;input id = &quot;clave&quot; name = &quot;clave&quot; type = &quot;password&quot;&gt;           </span>
<span class="linenos" data-linenos="27 "></span>
<span class="linenos" data-linenos="28 "></span><span class="x">            &lt;input type = &quot;submit&quot;&gt;</span>
<span class="linenos" data-linenos="29 "></span><span class="x">        &lt;/form&gt;</span>
<span class="linenos" data-linenos="30 "></span><span class="x">    &lt;/body&gt;</span>
<span class="linenos" data-linenos="31 "></span><span class="x">&lt;/html&gt;</span>
</code></pre></div>
<h5 id="accedir-a-parametres-no-existents">Accedir a paràmetres no existents<a class="headerlink" href="#accedir-a-parametres-no-existents" title="Permanent link">&para;</a></h5>
<p><img alt="" src="../img/t211.png" /></p>
<h4 id="validacio-del-formulari">Validació del formulari<a class="headerlink" href="#validacio-del-formulari" title="Permanent link">&para;</a></h4>
<p><a href="https://youtu.be/4wJDxsrGXX8"><img alt="" src="../img/ull.png" />Video</a></p>
<ul>
<li>Hem de comprovar que les dades del formulari són correctes</li>
<li>Validacions a realitzar:</li>
<li>Els camps requerits no han de quedar buits </li>
<li>Els camps email i data han de tenir el format esperat </li>
<li>Tots els camps s'han de filtrar.</li>
</ul>
<h6 id="valors-buits">Valors buits<a class="headerlink" href="#valors-buits" title="Permanent link">&para;</a></h6>
<ul>
<li>Els camps requerits no haurien de quedar-se buits.</li>
<li>Per a verificar que un valor no queda buit podem utilitzar la funció <strong>empty()</strong> de PHP. <a href="http://php.net/manual/es/function.empty.php">http://php.net/manual/es/function.empty.php</a> .</li>
</ul>
<h6 id="espais-en-blanc">Espais en blanc<a class="headerlink" href="#espais-en-blanc" title="Permanent link">&para;</a></h6>
<ul>
<li>Hem d'eliminar els espais en blanc del principi i final dels camps</li>
<li>S'utilitza la funció <strong>trim()</strong></li>
</ul>
<h6 id="filtrar-lentrada">Filtrar l'entrada<a class="headerlink" href="#filtrar-lentrada" title="Permanent link">&para;</a></h6>
<ul>
<li>Sempre hem de filtrar l'entrada amb <strong>htmlspecialchars()</strong> abans de mostrar el camp amb echo o similar. Si mostrem l'entrada tal cual podem patir atacs XSS o d'injecció.</li>
</ul>
<p><a href="https://youtu.be/Nak2B9eH3eY"><img alt="" src="../img/ull.png" />Video</a></p>
<h6 id="comprovar-lemail">Comprovar l'email<a class="headerlink" href="#comprovar-lemail" title="Permanent link">&para;</a></h6>
<ul>
<li>Per a verificar si un email és correcte podem utilitzar la funció <strong>filter_var</strong>($email, FILTER_VALIDATE_EMAIL)) <a href="http://php.net/manual/es/function.filter-var.php">http://php.net/manual/es/function.filter-var.php</a></li>
</ul>
<h6 id="dates">Dates<a class="headerlink" href="#dates" title="Permanent link">&para;</a></h6>
<ul>
<li>En PHP les dates s'emmagatzemen com a números.</li>
<li>S'utilitza la classe <strong>DateTime</strong> per a representar-les</li>
<li>Igual que ocorre amb les cadenes no té sentit estudiar les funcions relacionades una a una. Les pots consultar en: <a href="http://php.net/manual/es/ref.datetime.php">http://php.net/manual/es/ref.datetime.php</a></li>
<li>Per a comprovar la data devem crear una funció a aquest efecte</li>
<li>Podemos utilitzar el mètode <strong>createFromFormat()</strong> de la classe DateTime <a href="http://php.net/manual/es/datetime.createfromformat.php">http://php.net/manual/es/datetime.createfromformat.php</a></li>
</ul>
<h4 id="mostrar-els-errors-en-el-formulari">Mostrar els errors en el formulari<a class="headerlink" href="#mostrar-els-errors-en-el-formulari" title="Permanent link">&para;</a></h4>
<p><a href="https://youtu.be/TD10Rhw8ORs"><img alt="" src="../img/ull.png" />Video</a></p>
<p>El errors de validació s'han de guardar en una variable per a mostrar-los a l'usuari junt al formulari per tal que torne
a picar-los bé. També he de guardar els valors anteriors per mostrar-los també.</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">function isRequired($nomCamp,&amp;$errors){</span>
<span class="linenos" data-linenos="2 "></span><span class="x">        if (!empty($_POST[$nomCamp])) {</span>
<span class="linenos" data-linenos="3 "></span><span class="x">            return trim(htmlspecialchars($_POST[$nomCamp]));</span>
<span class="linenos" data-linenos="4 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="5 "></span><span class="x">        else {</span>
<span class="linenos" data-linenos="6 "></span><span class="x">            $errors[$nomCamp] = &quot;El $nomCamp és requerit&quot;;</span>
<span class="linenos" data-linenos="7 "></span><span class="x">            return null;</span>
<span class="linenos" data-linenos="8 "></span><span class="x">        }</span>
<span class="linenos" data-linenos="9 "></span><span class="x">    }</span>
</code></pre></div>
guarde en l'array <strong>errors</strong> el possible error.</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x"> function isValidClass($nomCamp,$errors){</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">         if (!isset($errors)) {</span>
<span class="linenos" data-linenos=" 3 "></span><span class="x">             return &#39;&#39;;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">         }</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">         if (isset($errors[$nomCamp])) {</span>
<span class="linenos" data-linenos=" 6 "></span><span class="x">             return &#39;is-invalid&#39;;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">         }</span>
<span class="linenos" data-linenos=" 8 "></span><span class="x">         return &#39;is-valid&#39;;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">     }</span>
<span class="linenos" data-linenos="10 "></span>
<span class="linenos" data-linenos="11 "></span><span class="x">     function showError($nomCamp,$errors){</span>
<span class="linenos" data-linenos="12 "></span><span class="x">         if (!isset($errors)) {</span>
<span class="linenos" data-linenos="13 "></span><span class="x">             return &#39;&#39;;</span>
<span class="linenos" data-linenos="14 "></span><span class="x">         }</span>
<span class="linenos" data-linenos="15 "></span><span class="x">         if (isset($errors[$nomCamp])) {</span>
<span class="linenos" data-linenos="16 "></span><span class="x">             return &quot;&lt;div class=&#39;invalid-feedback&#39;&gt;$errors[$nomCamp]&lt;/div&gt;&quot;;</span>
<span class="linenos" data-linenos="17 "></span><span class="x">         }</span>
<span class="linenos" data-linenos="18 "></span><span class="x">         return &quot;&lt;div class=&#39;valid-feedback&#39;&gt;All correct&lt;/div&gt;&quot;;</span>
<span class="linenos" data-linenos="19 "></span><span class="x">     }</span>
</code></pre></div>
funcions per a retornar el html necesari per a pintar els errors en bootsrap</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">    extract($_POST,EXTR_PREFIX_SAME,&#39;old&#39;);</span>
</code></pre></div>
genere variables old_nomdeCamp per als valors anterior</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">&lt;div class=&quot;form-group&quot;&gt;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    &lt;label for=&quot;assigned_to&quot;&gt;Assignada a:&lt;/label&gt;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">    &lt;input name=&quot;assigned_to&quot; type=&quot;text&quot; class=&quot;form-control </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">isValidClass</span><span class="p">(</span><span class="s1">&#39;assigned_to&#39;</span><span class="p">,</span><span class="nv">$errors</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="x">&quot; id=&quot;assigned-to&quot; aria-describedby=&quot;assignedHelp&quot; placeholder=&quot;Enter person assigned to&quot; value=&quot;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$old_assigned_to</span><span class="o">??</span><span class="s1">&#39;&#39;</span> <span class="cp">?&gt;</span><span class="x">&quot;&gt;</span>
<span class="linenos" data-linenos="4 "></span><span class="x">    &lt;small id=&quot;assignedHelp&quot; class=&quot;form-text text-muted&quot;&gt;Task&#39;s assigned to.&lt;/small&gt;</span>
<span class="linenos" data-linenos="5 "></span><span class="x">    </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">showError</span><span class="p">(</span><span class="s1">&#39;assigned_to&#39;</span><span class="p">,</span><span class="nv">$errors</span><span class="p">)</span> <span class="cp">?&gt;</span>
<span class="linenos" data-linenos="6 "></span><span class="x">&lt;/div&gt;</span>
</code></pre></div>
mostre els errors utilitzant les funcions anterior i el camp old_title</p>
<h3 id="pujada-de-fitxers">Pujada de fitxers<a class="headerlink" href="#pujada-de-fitxers" title="Permanent link">&para;</a></h3>
<p><a href="https://youtu.be/eM5onvdJ_qg"><img alt="" src="../img/ull.png" />Video</a></p>
<p>Es un cas especial. En primer lloc en el formulari cal utilitzar l'atribut enctype="multipart/form-data" i el metode POST. Per al fitxer s'utilitza una etiqueta \<input type="file">.</p>
<p>```php</p>
<!DOCTYPE html>
<html>
    <body>
        <form action="procesar_subida.php" method="post" enctype="multipart/form-data">    
            Escoja un fichero
            <input type="file" name="fichero">
            <input type="submit" value="Subir fichero">
        </form>
    </body>
</html>
<p>```</p>
<p>En l'script que reb el fitxer la variable global <em>$_FILES</em> conté la informació sobre el fitxer en un array bidimensional.</p>
<h4 id="elements-del-array-del-fitxer-pujat">Elements del array del fitxer pujat<a class="headerlink" href="#elements-del-array-del-fitxer-pujat" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>$_FILES['imatge']['tmp_name']</strong>: lloc i nom de l'arxiu temporal en el servidor.</li>
<li><strong>$_FILES['imatge']['name']</strong>: Nom original del fitxer en la màquina client.</li>
<li><strong>$_FILES['imatge'][size']</strong>: Grandària en bytes del fitxer pujat.</li>
<li><strong>$_FILES['imatge'][type']</strong>: Tipus MIME associat al fitxer. Per exemple, "image/gif" o "text/plain".</li>
<li><strong>$_FILES['imatge'][error']</strong>: Codi d'error associat al fitxer pujat.  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="cp">&lt;?php</span>
<span class="linenos" data-linenos=" 2 "></span>    <span class="nv">$tam</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&quot;fichero&quot;</span><span class="p">][</span><span class="s2">&quot;size&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos=" 3 "></span>    <span class="k">if</span><span class="p">(</span><span class="nv">$tam</span> <span class="o">&gt;</span> <span class="mi">256</span> <span class="o">*</span><span class="mi">1024</span><span class="p">){</span>
<span class="linenos" data-linenos=" 4 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;br&gt;Demasiado grande&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span>        <span class="k">return</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">echo</span> <span class="s2">&quot;Nombre del fichero: &quot;</span> <span class="o">.</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&quot;fichero&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">];</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="k">echo</span> <span class="s2">&quot;&lt;br&gt;Nombre temporal del fichero en sel servidor: &quot;</span> <span class="o">.</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&quot;fichero&quot;</span><span class="p">][</span><span class="s2">&quot;tmp_name&quot;</span><span class="p">];</span>  
<span class="linenos" data-linenos=" 9 "></span>    <span class="nv">$res</span> <span class="o">=</span> <span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&quot;fichero&quot;</span><span class="p">][</span><span class="s2">&quot;tmp_name&quot;</span><span class="p">],</span><span class="s2">&quot;subidos/&quot;</span> <span class="o">.</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&quot;fichero&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]);</span>
<span class="linenos" data-linenos="10 "></span>    <span class="k">if</span><span class="p">(</span><span class="nv">$res</span><span class="p">){</span>
<span class="linenos" data-linenos="11 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;br&gt;Fichero guardado&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">echo</span> <span class="s2">&quot;&lt;br&gt;Error&quot;</span><span class="p">;</span>
<span class="linenos" data-linenos="14 "></span>    <span class="p">}</span>
<span class="linenos" data-linenos="15 "></span> <span class="sb">```</span>
<span class="linenos" data-linenos="16 "></span><span class="sb">[![](../img/ull.png)Video](https://youtu.be/vlYrDiFV0Jg) </span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span><span class="sb">#### Grandària del fitxer a pujar</span>
<span class="linenos" data-linenos="19 "></span><span class="sb">* Podemos fixar el límit de grandària en el fitxer php.ini</span>
<span class="linenos" data-linenos="20 "></span><span class="sb">    * http://php.net/manual/es/ini.core.php#ini.upload-max-filesize</span>
<span class="linenos" data-linenos="21 "></span><span class="sb">* També podem fixar el límit en el propi formulari</span>
<span class="linenos" data-linenos="22 "></span><span class="sb">* A través d&#39;un camp ocult (type=&quot;hidden&quot;) denominat **MAX_FILE_SIZE**.</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span><span class="sb"> ```</span><span class="nx">php</span>
<span class="linenos" data-linenos="25 "></span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;MAX_FILE_SIZE&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;1000000&quot;</span><span class="o">&gt;</span>
<span class="linenos" data-linenos="26 "></span> <span class="sb">```</span>
<span class="linenos" data-linenos="27 "></span>
<span class="linenos" data-linenos="28 "></span><span class="sb">#### Ruta temporal del fitxer pujat</span>
<span class="linenos" data-linenos="29 "></span><span class="sb">* En carregar un arxiu, es guardarà en una ubicació temporal indicada per l&#39;opció upload_tmp_dir en el php.ini.</span>
<span class="linenos" data-linenos="30 "></span><span class="sb">    * http://php.net/manual/es/ini.core.php#ini.upload-tmp-dir</span>
<span class="linenos" data-linenos="31 "></span><span class="sb">* Si no movem l&#39;arxiu o ho canviem de nom, quan acabe l&#39;execució del script, este serà eliminat.</span>
<span class="linenos" data-linenos="32 "></span>
<span class="linenos" data-linenos="33 "></span>
<span class="linenos" data-linenos="34 "></span><span class="sb">#### Problemes més habituals</span>
<span class="linenos" data-linenos="35 "></span><span class="sb">* Especificar en upload\_tmp\_dir un directori al com no es té accés</span>
<span class="linenos" data-linenos="36 "></span><span class="sb">* La directiva memory\_limit té un valor molt baix o inferior a upload_max_filesize</span>
<span class="linenos" data-linenos="37 "></span><span class="sb">* La directiva max\_execution\_time té un valor baix i el script ho excedeix durant la pujada del fitxer</span>
<span class="linenos" data-linenos="38 "></span><span class="sb">* La directiva post\_max\_size té un valor baix i el teu fitxer ho excedeix. El seu valor ha de ser major a upload\_max\_filesize</span>
<span class="linenos" data-linenos="39 "></span>
<span class="linenos" data-linenos="40 "></span><span class="sb">##### Codis d&#39;error</span>
<span class="linenos" data-linenos="41 "></span><span class="sb">* El primer que caldrà fer és comprovar el codi d&#39;error del fitxer pujat **($_FILES[&#39;imatge&#39;][error&#39;])**</span>
<span class="linenos" data-linenos="42 "></span><span class="sb">* Si és diferent de **UPLOAD_ERR_OK** hi ha hagut algun problema</span>
<span class="linenos" data-linenos="43 "></span><span class="sb">* Veure els codis d&#39;error:</span>
<span class="linenos" data-linenos="44 "></span><span class="sb">    * http://php.net/manual/es/features.file-upload.errors.php</span>
<span class="linenos" data-linenos="45 "></span>
<span class="linenos" data-linenos="46 "></span><span class="sb">##### Comprovació del tipus de fitxer</span>
<span class="linenos" data-linenos="47 "></span><span class="sb">* A continuació comprovarem que el tipus myme està dins dels esperats:</span>
<span class="linenos" data-linenos="48 "></span>
<span class="linenos" data-linenos="49 "></span><span class="sb">```</span><span class="nx">php</span>
<span class="linenos" data-linenos="50 "></span><span class="k">if</span> <span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;imatge&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;image/gif&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-linenos="51 "></span>    <span class="k">echo</span> <span class="s1">&#39;Error: No es tracta d&#39;</span><span class="nx">un</span> <span class="nx">fitxer</span> <span class="o">.</span><span class="nx">GIF</span><span class="o">.</span><span class="err">&#39;</span><span class="p">;</span> 
<span class="linenos" data-linenos="52 "></span>    <span class="k">exit</span><span class="p">;</span> 
<span class="linenos" data-linenos="53 "></span> <span class="p">}</span>
</code></pre></div>
<h5 id="evitar-atacs">Evitar atacs<a class="headerlink" href="#evitar-atacs" title="Permanent link">&para;</a></h5>
<ul>
<li>Ataque comú:<ul>
<li>http://seclists.org/bugtraq/2000/sep/55</li>
</ul>
</li>
<li>Per a evitar aquest tipus d'atacs es va incloure la funció:<ul>
<li>bool is_uploaded_file ( string nom_arxiu )</li>
</ul>
</li>
<li>Retorna true si l'arxiu donat va ser carregat a través d'HTTP POST</li>
<li>Li passarem el paràmetre <strong>$_FILES['imatge']['tmp_name']</strong></li>
</ul>
<h5 id="moure-larxiu-pujat">Moure l'arxiu pujat<a class="headerlink" href="#moure-larxiu-pujat" title="Permanent link">&para;</a></h5>
<ul>
<li>Per a moure l'arxiu temporal a la seua ubicació correcta usem la funció<ul>
<li>bool move_uploaded_file(string nom_arxiu, string destinació)</li>
</ul>
</li>
<li>Aquesta funció s'assegura que l'arxiu siga un arxiu carregat vàlid.</li>
<li>Si existeix un arxiu destine amb el mateix nom, est serà sobreescrit.</li>
</ul>
<h5 id="evitar-sobrescritures">Evitar sobrescritures<a class="headerlink" href="#evitar-sobrescritures" title="Permanent link">&para;</a></h5>
<ul>
<li>Abans de moure l'arxiu pujat és convenient comprovar que no existeix un arxiu amb el mateix nom<ul>
<li>bool is_file(string nom_arxiu) </li>
<li>Li passarem $_FILES['imatge']['name']</li>
</ul>
</li>
<li>En cas que existisca caldrà canviar el nom, per exemple afegint una marca de temps com a prefix</li>
</ul>
<h2 id="fitxers">Fitxers<a class="headerlink" href="#fitxers" title="Permanent link">&para;</a></h2>
<h3 id="obrir-un-arxiu">Obrir un arxiu<a class="headerlink" href="#obrir-un-arxiu" title="Permanent link">&para;</a></h3>
<p>Els arxius en <strong>PHP</strong> s'obrin amb la funció <strong>fopen()</strong>, que requereix dos paràmetres: l'arxiu que es vol obrir i la manera en què obrir l'arxiu. La funció retorna un punter en l'arxiu si és satisfactòria o zero si no ho és. Els arxius s'obrin per a realitzar operacions de lectura o escriptura.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$fp = fopen(&quot;miarchivo.txt&quot;, &quot;r&quot;);</span>
</code></pre></div>
<p>Si no és possible obrir l'arxiu, retorna zero, per això és freqüent utilitzar aquesta funció en una condició:</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">if (!$fp = fopen(&quot;miarchivo.txt&quot;, &quot;r&quot;)){</span>
<span class="linenos" data-linenos="2 "></span><span class="x">    echo &quot;No se ha podido abrir el archivo&quot;;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">}</span>
</code></pre></div>
Es pot obrir un arxiu però també una URL externa, ja que <strong>fopen()</strong> realment el que fa és crear una connexió, per això cal tancar-la posteriorment.</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$fp = fopen(&quot;http://localhost:8000&quot;, &quot;r&quot;);</span>
</code></pre></div>
Les maneres d'accés existents per a <a href="https://www.php.net/manual/es/function.fopen.php">fopen</a> és poden trobrar a la documentació oficial.</p>
<h3 id="llegir-un-arxiu">Llegir un arxiu<a class="headerlink" href="#llegir-un-arxiu" title="Permanent link">&para;</a></h3>
<p>Una vegada obert l'arxiu, el llegirem i guardar els seus continguts en una variable amb <strong>fread()</strong>:</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$file = &quot;miarchivo.txt&quot;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$fp = fopen($file, &quot;r&quot;);</span>
<span class="linenos" data-linenos="3 "></span><span class="x">$contents = fread($fp, filesize($file));</span>
</code></pre></div>
La variable <strong>contents</strong> guardarà el contingut que obtinguem amb la funció <strong>fread()</strong>. Aquesta funció requereix dos paràmetres, l'arxiu obert i la longitud que volem llegir d'aquest arxiu (en bytes). En aquest cas hem emprat la funció <strong>filesize()</strong> per a obtindre la grandària de l'arxiu i així retornar tot el seu contingut.</p>
<h3 id="tancar-un-arxiu">Tancar un arxiu<a class="headerlink" href="#tancar-un-arxiu" title="Permanent link">&para;</a></h3>
<p>Finalment, tancarem l'arxiu (no és obligatori però es recomana):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">fclose($fp);</span>
</code></pre></div>
<h3 id="escriure-en-un-arxiu">Escriure en un arxiu<a class="headerlink" href="#escriure-en-un-arxiu" title="Permanent link">&para;</a></h3>
<p>Igual que per a llegir un arxiu, hi ha més d'una manera d'escriure en un. La forma més bàsica és utilitzar la funció <strong>fwrite()</strong> (o <strong>fputs()</strong>, que és el seu àlies):</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$file = &quot;miarchivo.txt&quot;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$texto = &quot;Hola que tal&quot;;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">$fp = fopen($file, &quot;w&quot;);</span>
<span class="linenos" data-linenos="4 "></span><span class="x">fwrite($fp, $texto);</span>
<span class="linenos" data-linenos="5 "></span><span class="x">fclose($fp);</span>
</code></pre></div>
Aquesta vegada hem emprat la manera w, que permet escriure sobreescrivint l'arxiu.</p>
<p>Podem limitar la longitud de dades que volem escriure (totes les dades que hi havia en l'arxiu s'esborraran per complet igualment):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$file = &quot;miarchivo.txt&quot;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">$texto = &quot;Hola que tal&quot;;</span>
<span class="linenos" data-linenos="3 "></span><span class="x">$fp = fopen($file, &quot;w&quot;);</span>
<span class="linenos" data-linenos="4 "></span><span class="x">fwrite($fp, $texto, 4); // Escribirá sólo: Hola</span>
</code></pre></div>
<p>Si l'arxiu <em>^miarchivo.txt^^ no existeix, es crearà automàticament amb la manera w de la funció </em><em>fopen</em>*.</p>
<h3 id="punter-darxiu">Punter d'arxiu<a class="headerlink" href="#punter-darxiu" title="Permanent link">&para;</a></h3>
<p>Un punter d'arxiu (<strong>file pointer</strong> o <strong>handle</strong>) és una variable que fa referència a un arxiu. És una variable que apunta a un arxiu en concret, i normalment s'obté quan s'obri amb <strong>fopen()</strong>.</p>
<p><strong>PHP</strong> i la seua recol·lecció de fems tanca tots els punters d'arxius al final de l'execució del <strong>script</strong>, encara que es considera una bona pràctica tancar els arxius manualment amb <strong>fclose()</strong>.</p>
<p>A més d'apuntar a un arxiu, apunta a una posició concreta en aqueix arxiu. En la majoria dels casos quan s'obri un arxiu el punter apunta al principi (posició 0) o al final de l'arxiu.</p>
<p>La funció <strong>feof()</strong> és utilitzada amb freqüència en el maneig d'arxius en <strong>PHP</strong>. Aquesta funció comprova si el punter es troba al final de l'arxiu. S'utilitza quan es recorre un arxiu línia per línia o per a la lectura de grans arxius, mitjançant un condicional:</p>
<p><div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="x">$archivo = &quot;miarchivo.txt&quot;;</span>
<span class="linenos" data-linenos="2 "></span><span class="x">// Abrimos el archivo</span>
<span class="linenos" data-linenos="3 "></span><span class="x">$fp = fopen($archivo, &quot;r&quot;);</span>
<span class="linenos" data-linenos="4 "></span><span class="x">// Loop que parará al final del archivo, cuando feof sea true:</span>
<span class="linenos" data-linenos="5 "></span><span class="x">while(!feof($fp)){</span>
<span class="linenos" data-linenos="6 "></span><span class="x">    echo fread($fp, 4092);</span>
<span class="linenos" data-linenos="7 "></span><span class="x">}</span>
</code></pre></div>
El codi anterior només carregarà <strong>4kb</strong> de dades de vegada, la qual cosa redueix l'ús de memòria per a grans arxius.</p>
<h3 id="obtindre-informacio-dun-arxiu">Obtindre informació d'un arxiu<a class="headerlink" href="#obtindre-informacio-dun-arxiu" title="Permanent link">&para;</a></h3>
<p>Es pot obtindre informació d'un arxiu a més del seu contingut: grandària, última vegada que s'ha accedit o modificat, nombre de links, etc. La funció principal per a obtindre aquesta informació és amb la funció <strong>stat()</strong>, en aquesta taula es poden veure els 12 elements que retorna el <strong>array</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="x">$file = &quot;miarchivo.txt&quot;;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="x">$texto = &quot;Todos somos muy ignorantes, lo que ocurre es que no todos ignoramos las mismas cosas.&quot;;</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="x">$fp = fopen($file, &quot;w&quot;);</span>
<span class="linenos" data-linenos=" 5 "></span><span class="x">fwrite($fp, $texto);</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="x">$datos = stat($file);</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="x">echo $datos[3] . &quot;&lt;br&gt;&quot;; // Número de enlaces, 1</span>
<span class="linenos" data-linenos="10 "></span><span class="x">echo $datos[7] . &quot;&lt;br&gt;&quot;; // Tamaño en bytes, 85</span>
<span class="linenos" data-linenos="11 "></span><span class="x">echo $datos[8] . &quot;&lt;br&gt;&quot;; // Momento de último acceso, 1444138104</span>
<span class="linenos" data-linenos="12 "></span><span class="x">echo $datos[9] . &quot;&lt;br&gt;&quot;; // Momento de última modificación, 1444138251</span>
</code></pre></div>
<h3 id="funcions-de-directoris">Funcions de directoris<a class="headerlink" href="#funcions-de-directoris" title="Permanent link">&para;</a></h3>
<p>Les funcions de directoris vénen de l'extensió <strong>directories de PHP</strong>. Hi ha un total de 9 funcions disponibles que podeu consultar en la <a href="https://www.php.net/manual/es/book.dir.php">documentació</a></p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2024 Xavier Sastre - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["header.autohide", "toc.integrate", "content.tabs.link", "navigation.expand"], "search": "assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiat al porta-retalls", "clipboard.copy": "C\u00f2pia al porta-retalls", "search.result.more.one": "1 m\u00e9s en aquesta p\u00e0gina", "search.result.more.other": "# m\u00e9s en aquesta p\u00e0gina", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.term.missing": "Desaparegut", "select.version": "Selecciona la versi\u00f3"}}</script>
    
    
      <script src="assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>